<!doctype html>
<html dir="rtl" lang="ar">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>استعادة كلمة المرور — المدونين</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.7.2/css/all.min.css" />
    <link rel="stylesheet" href="/style.css" />
    <style>
      body { min-height: 100vh; display: grid; place-items: center; background: #0b0b0c; color: #fff; font-family: system-ui, -apple-system, Segoe UI, Roboto, "Helvetica Neue", Arial }
      .card { width: min(520px, 92vw); background: #121214; border: 1px solid #222; border-radius: 14px; padding: 28px; box-shadow: 0 10px 30px rgba(0,0,0,.35) }
      header { display: flex; align-items: center; gap: 12px; margin-bottom: 18px }
      header img { width: 42px; height: 42px; border-radius: 8px; object-fit: cover }
      h1 { font-size: 1.15rem; margin: 0 }
      p { color: #bbb; margin: 6px 0 0; font-size: .95rem }
      form { display: grid; gap: 12px; margin-top: 14px }
      label { display: grid; gap: 6px; font-size: .95rem; color: #ddd }
      input[type=email] { background: #0f0f11; color: #fff; border: 1px solid #2a2a2e; border-radius: 10px; padding: 12px 14px }
      .actions { display: flex; gap: 10px; align-items: center }
      button.btn-primary { display: inline-flex; align-items: center; gap: 8px; background: #0ea5e9; color: #fff; border: none; border-radius: 10px; padding: 10px 14px; cursor: pointer }
      .muted { color: #9aa; font-size: .9rem }
      .alert { background:#0d1b0d; border:1px solid #1b3a1b; color:#b5f7b5; padding:10px 12px; border-radius:10px }
      .error { background:#2a1212; border-color:#612; color:#ffb0b0 }
      a { color: #9ecbff }
    </style>
  </head>
  <body>
    <div class="card" role="main">
      <header>
        <img alt="شعار نادي أديب" src="https://lh3.googleusercontent.com/d/195w-tUBF_VKwFOm3Sh06fmwnlYzIyw0e" />
        <div>
          <h1>استعادة كلمة المرور</h1>
          <p>أدخل بريدك لإرسال رابط إعادة تعيين كلمة المرور.</p>
        </div>
      </header>

      <div id="status" class="muted"></div>

      <form id="forgotForm">
        <label>
          البريد الإلكتروني
          <input id="email" name="email" type="email" inputmode="email" autocomplete="email" required placeholder="name@example.com" />
        </label>
        <div class="actions">
          <button type="submit" class="btn-primary"><i class="fa-solid fa-envelope"></i> إرسال رابط الاستعادة</button>
          <span id="msg" class="muted" aria-live="polite"></span>
        </div>
      </form>

      <div class="footer-links" style="display:flex;justify-content:space-between;margin-top:10px">
        <a href="login.html"><i class="fa-solid fa-right-to-bracket"></i> الرجوع لتسجيل الدخول</a>
        <a href="../blog/blog.html"><i class="fa-solid fa-anchor"></i> المدونة</a>
      </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="../supabase-config.js"></script>
    <script>
      (function() {
        const sb = window.sbClient;
        const status = document.getElementById('status');
        const form = document.getElementById('forgotForm');
        if (!sb) {
          status.className = 'alert error';
          status.textContent = 'Supabase غير مفعّل.';
          form.querySelector('button').disabled = true;
          return;
        }
        form.addEventListener('submit', async (e) => {
          e.preventDefault();
          const email = document.getElementById('email').value.trim();
          if (!email) return;
          const btn = form.querySelector('button'); btn.disabled = true; btn.style.opacity = .7;
          try {
            const { error } = await sb.auth.resetPasswordForEmail(email, {
              redirectTo: new URL('/marafi/blogger/reset-password.html', location.origin).href
            });
            if (error) throw error;
            status.className = 'alert';
            status.textContent = 'تم إرسال رابط إعادة التعيين إلى بريدك.';
          } catch (err) {
            status.className = 'alert error';
            status.textContent = 'تعذر الإرسال: ' + (err?.message || 'حدث خطأ');
          } finally {
            btn.disabled = false; btn.style.opacity = 1;
          }
        });
      })();
    </script>
  </body>
</html>
