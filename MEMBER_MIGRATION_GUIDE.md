# ๐ ุฏููู ูุธุงู ุชุฑุญูู ุงูููุจูููู ุฅูู ุญุณุงุจุงุช ูุณุชุฎุฏููู

## ๐ ูุธุฑุฉ ุนุงูุฉ

ูุธุงู ุชุฑุญูู ุงุญุชุฑุงูู ูุชูุงูู ูุชุญููู ุงูุฃุนุถุงุก ุงูููุจูููู ูู ูุชุงุฆุฌ ุงูุนุถููุฉ ุฅูู ุญุณุงุจุงุช ูุณุชุฎุฏููู ุญููููุฉ ูู ุงููุธุงูุ ูุน ุฅููุงููุฉ ุชุนุฏูู ุงููุฌุงู ูุจู ุงูุชุฑุญูู.

---

## ๐ฏ ุงููููุฒุงุช ุงูุฑุฆูุณูุฉ

### โ ุงููููุฒุงุช ุงูุฃุณุงุณูุฉ
- โจ ุนุฑุถ ุฌููุน ุงูููุจูููู ุงูุฐูู ูู ูุชู ุชุฑุญูููู ุจุนุฏ
- ๐ ุฅููุงููุฉ ุชุนุฏูู ุงููุฌูุฉ ูุฃู ุนุถู ูุจู ุงูุชุฑุญูู
- ๐ค ุชุฑุญูู ูุฑุฏู ุฃู ุฌูุงุนู (ุฏูุนุฉ ูุงุญุฏุฉ)
- ๐ ุฅูุดุงุก ุญุณุงุจุงุช ุขููุฉ ูุน ูููุงุช ูุฑูุฑ ูุคูุชุฉ
- ๐ง ุฅุฑุณุงู ุจูุงูุงุช ุงูุฏุฎูู ููุฃุนุถุงุก
- ๐ ุฑุจุท ุชููุงุฆู ุจุฏูุฑ "ุนุถู ุนุงุฏู" ูุงููุฌูุฉ ุงููุญุฏุฏุฉ
- ๐ ุชุชุจุน ูุงูู ูุนูููุฉ ุงูุชุฑุญูู

### ๐ก๏ธ ุงูุฃูุงู ูุงูููุซูููุฉ
- โ Edge Function ุขููุฉ ูุน ุตูุงุญูุงุช Service Role
- โ ุงูุชุญูู ูู ุตูุงุญูุงุช ุงููุณุคูู ูุจู ุงูุชุฑุญูู
- โ ููุน ุงูุชุฑุญูู ุงูููุฑุฑ (ูุญุต migrated_to_user_id)
- โ Rollback ุชููุงุฆู ูู ุญุงูุฉ ุงููุดู
- โ ุชุณุฌูู ูุงูู ูู activity_log

---

## ๐ฆ ุงููููุงุช ุงููุถุงูุฉ

### 1. Migration
```
supabase/migrations/055_add_migration_tracking_fields.sql
```
- ุฅุถุงูุฉ ุญููู ุงูุชุชุจุน ูู `membership_interviews`
- ุฅุถุงูุฉ ุญููู ุงููุตุฏุฑ ูู `profiles`
- ููุงุฑุณ ูุชุญุณูู ุงูุฃุฏุงุก

### 2. Edge Function
```
supabase/functions/migrate-accepted-member/index.ts
```
- ุฅูุดุงุก ุญุณุงุจ ูู auth.users
- ุฅูุดุงุก profile
- ุฑุจุท ุจุงูุฏูุฑ ูุงููุฌูุฉ
- ุชุณุฌูู ุงููุดุงุท

### 3. Frontend
```
admin/js/member-migration.js          # ููุทู ุงูุชุฑุญูู
admin/css/member-migration.css        # ุชูุณููุงุช ุงูุจุทุงูุงุช
admin/dashboard.html                  # ูุณู ุงูุชุฑุญูู
admin/dashboard.js                    # ุฑุจุท ุงููุณู
```

---

## ๐ง ุฎุทูุงุช ุงูุชุซุจูุช

### ุงูุฎุทูุฉ 1๏ธโฃ: ุชุทุจูู Migration

```bash
# ุงูุทุฑููุฉ ุงูุฃููู: ุนุจุฑ Supabase CLI
cd supabase
supabase db push

# ุงูุทุฑููุฉ ุงูุซุงููุฉ: ุนุจุฑ MCP Tools
```

ุงุณุชุฎุฏู ุฃุฏุงุฉ `mcp0_apply_migration`:

```javascript
{
  "project_id": "nnlhkfeybyhvlinbqqfa",
  "name": "add_migration_tracking_fields",
  "query": "ูุญุชูู ููู 055_add_migration_tracking_fields.sql"
}
```

### ุงูุฎุทูุฉ 2๏ธโฃ: ุฑูุน Edge Function

```bash
# ุชุฃูุฏ ูู ุชุณุฌูู ุงูุฏุฎูู
supabase login

# ุฑูุน ุงูู Function
supabase functions deploy migrate-accepted-member --project-ref nnlhkfeybyhvlinbqqfa
```

ุฃู ุงุณุชุฎุฏู ุฃุฏุงุฉ `mcp0_deploy_edge_function`:

```javascript
{
  "project_id": "nnlhkfeybyhvlinbqqfa",
  "name": "migrate-accepted-member",
  "entrypoint_path": "index.ts",
  "verify_jwt": true,
  "files": [
    {
      "name": "index.ts",
      "content": "ูุญุชูู ุงูููู"
    }
  ]
}
```

### ุงูุฎุทูุฉ 3๏ธโฃ: ุงูุชุญูู ูู ุงูุตูุงุญูุงุช

ุชุฃูุฏ ูู ุฃู ุงููุณุชุฎุฏููู ุงููุณููุญ ููู ุจุงูุชุฑุญูู ูุฏููู:
- `role_level >= 7` (ูุฌูุณ ุฅุฏุงุฑู ุฃู ุฃุนูู)
- ุตูุงุญูุฉ ุงููุตูู ููุณู "ุชุฑุญูู ุงูููุจูููู"

---

## ๐ ุฏููู ุงูุงุณุชุฎุฏุงู

### 1. ุงููุตูู ุฅูู ูุณู ุงูุชุฑุญูู

1. ุณุฌู ุงูุฏุฎูู ุฅูู ููุญุฉ ุงูุชุญูู
2. ูู ุงููุงุฆูุฉ ุงูุฌุงูุจูุฉุ ุงุฎุชุฑ **ุฅุฏุงุฑุฉ ุงูุนุถููุฉ**
3. ุงุฎุชุฑ **ุชุฑุญูู ุงูููุจูููู**

### 2. ุนุฑุถ ุงูููุจูููู

ุณุชุฑู:
- ๐ **ุฅุญุตุงุฆูุงุช**: ุฅุฌูุงูู ุงูููุจููููุ ุจุงูุชุธุงุฑ ุงูุชุฑุญููุ ุชู ุชุฑุญูููู
- ๐ **ููุงุชุฑ**: ุจุญุซ ุจุงูุงุณู/ุงูุจุฑูุฏุ ููุชุฑ ุญุณุจ ุงููุฌูุฉ
- ๐ **ุจุทุงูุงุช**: ุนุฑุถ ุชูุตููู ููู ุนุถู ููุจูู

### 3. ุชุนุฏูู ุงููุฌูุฉ

ูุชุบููุฑ ูุฌูุฉ ุนุถู ูุจู ุงูุชุฑุญูู:
1. ุงุจุญุซ ุนู ุงูุนุถู ูู ุงููุงุฆูุฉ
2. ูู ุงููุงุฆูุฉ ุงูููุณุฏูุฉ "ุงููุฌูุฉ"ุ ุงุฎุชุฑ ุงููุฌูุฉ ุงูุฌุฏูุฏุฉ
3. ุณูุชู ุญูุธ ุงูุชุบููุฑ ุชููุงุฆูุงู ุนูุฏ ุงูุชุฑุญูู

### 4. ุชุฑุญูู ุนุถู ูุงุญุฏ

1. ุงุถุบุท ุนูู ุฒุฑ **"ุชุฑุญูู ุฅูู ุญุณุงุจ"** ูู ุจุทุงูุฉ ุงูุนุถู
2. ุฑุงุฌุน ุงูุจูุงูุงุช ูู ูุงูุฐุฉ ุงูุชุฃููุฏ
3. ุงุถุบุท **"ูุนูุ ุชุฑุญูู"**
4. ุณุชุธูุฑ ูุงูุฐุฉ ุจูุง:
   - ุงูุจุฑูุฏ ุงูุฅููุชุฑููู
   - ูููุฉ ุงููุฑูุฑ ุงููุคูุชุฉ
5. **ููู**: ุงุญูุธ ูููุฉ ุงููุฑูุฑ ูุฃุฑุณููุง ููุนุถู

### 5. ุชุฑุญูู ุฏูุนุฉ

1. ุญุฏุฏ ุงูุฃุนุถุงุก ุงููุฑุงุฏ ุชุฑุญูููู (checkbox)
2. ุฃู ุงุถุบุท **"ุชุญุฏูุฏ ุงููู"**
3. ุงุถุบุท **"ุชุฑุญูู ุงููุญุฏุฏูู"**
4. ุฑุงุฌุน ุงูุนุฏุฏ ูู ูุงูุฐุฉ ุงูุชุฃููุฏ
5. ุงุถุบุท **"ูุนูุ ุชุฑุญูู ุงููู"**
6. ุงูุชุธุฑ ุญุชู ุชูุชูู ุงูุนูููุฉ
7. ุณุชุธูุฑ ูุงูุฐุฉ ุจูุชุงุฆุฌ ุงูุชุฑุญูู ููู ุนุถู

---

## ๐ ุงูุชุญูู ูู ูุฌุงุญ ุงูุชุฑุญูู

### ูู ูุณู "ุฅุฏุงุฑุฉ ุงููุณุชุฎุฏููู"
1. ุงูุชูู ุฅูู **ุฅุฏุงุฑุฉ ุงููุณุชุฎุฏููู**
2. ุงุจุญุซ ุนู ุงูุฃุนุถุงุก ุงููุฑุญููู
3. ุชุญูู ูู:
   - โ ุงูุญุณุงุจ ููุฌูุฏ
   - โ ุงูุฏูุฑ: "ุนุถู ุนุงุฏู"
   - โ ุงููุฌูุฉ ุตุญูุญุฉ
   - โ ุงูุญุงูุฉ: "ูุดุท"

### ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช

```sql
-- ุงูุชุญูู ูู ุงูุชุฑุญูู
SELECT 
    mi.id,
    ma.full_name,
    mi.migrated_to_user_id,
    mi.migrated_at,
    p.email,
    ur.committee_id
FROM membership_interviews mi
JOIN membership_applications ma ON mi.application_id = ma.id
LEFT JOIN profiles p ON mi.migrated_to_user_id = p.id
LEFT JOIN user_roles ur ON p.id = ur.user_id
WHERE mi.result = 'accepted'
AND mi.migrated_to_user_id IS NOT NULL
ORDER BY mi.migrated_at DESC;
```

---

## โ๏ธ ุงุณุชูุดุงู ุงูุฃุฎุทุงุก

### ุงููุดููุฉ: "Failed to create auth user"

**ุงูุฃุณุจุงุจ ุงููุญุชููุฉ:**
- ุงูุจุฑูุฏ ุงูุฅููุชุฑููู ูุณุชุฎุฏู ูุณุจูุงู
- ุตูุบุฉ ุงูุจุฑูุฏ ุบูุฑ ุตุญูุญุฉ
- ูุดููุฉ ูู ุงุชุตุงู Supabase Auth

**ุงูุญู:**
1. ุชุญูู ูู ุนุฏู ูุฌูุฏ ุญุณุงุจ ุจููุณ ุงูุจุฑูุฏ
2. ุชุญูู ูู ุตุญุฉ ุงูุจุฑูุฏ ุงูุฅููุชุฑููู
3. ุฑุงุฌุน logs ุงูู Edge Function

### ุงููุดููุฉ: "Interview not found or already migrated"

**ุงูุณุจุจ:**
- ุงูุนุถู ุชู ุชุฑุญููู ูุณุจูุงู
- ูุนุฑู ุงูููุงุจูุฉ ุบูุฑ ุตุญูุญ

**ุงูุญู:**
- ุชุญุฏูุซ ุงูุตูุญุฉ
- ุงูุชุญูู ูู ุญูู `migrated_to_user_id`

### ุงููุดููุฉ: "Unauthorized"

**ุงูุณุจุจ:**
- ุงููุณุชุฎุฏู ูุง ูููู ุตูุงุญูุงุช ูุงููุฉ
- ุงูุชูุช ุฌูุณุฉ ุงูุฏุฎูู

**ุงูุญู:**
- ุชุณุฌูู ุงูุฎุฑูุฌ ูุงูุฏุฎูู ูุฑุฉ ุฃุฎุฑู
- ุงูุชุญูู ูู ุตูุงุญูุงุช ุงููุณุชุฎุฏู

---

## ๐ ุจููุฉ ูุงุนุฏุฉ ุงูุจูุงูุงุช

### ุงูุญููู ุงููุถุงูุฉ

#### ูู `membership_interviews`:
```sql
migrated_to_user_id uuid        -- ูุนุฑู ุงููุณุชุฎุฏู ุงููุฑุญู ุฅููู
migrated_at timestamptz         -- ุชุงุฑูุฎ ุงูุชุฑุญูู
migration_notes text            -- ููุงุญุธุงุช ุงูุชุฑุญูู
```

#### ูู `profiles`:
```sql
source_application_id uuid      -- ูุนุฑู ุทูุจ ุงูุนุถููุฉ ุงูุฃุตูู
source_interview_id uuid        -- ูุนุฑู ุงูููุงุจูุฉ ุงูุฃุตููุฉ
```

---

## ๐ ุงูุฃูุงู

### ุตูุงุญูุงุช Edge Function
- โ ุชุณุชุฎุฏู `SUPABASE_SERVICE_ROLE_KEY` ููุท
- โ ุชุชุญูู ูู ูููุฉ ุงููุณุคูู ุนุจุฑ JWT
- โ ูุง ุชูุจู ุทูุจุงุช ุบูุฑ ูุตุฑุญ ุจูุง

### ูููุงุช ุงููุฑูุฑ ุงููุคูุชุฉ
- ๐ 12 ุญุฑู ุนุดูุงุฆู
- ๐ ุชุญุชูู ุนูู ุฃุญุฑู ูุจูุฑุฉ ูุตุบูุฑุฉ ูุฃุฑูุงู ูุฑููุฒ
- ๐ ูุฌุจ ุนูู ุงูุนุถู ุชุบููุฑูุง ุนูุฏ ุฃูู ุชุณุฌูู ุฏุฎูู

---

## ๐ ููุงุญุธุงุช ูููุฉ

### โ๏ธ ูุจู ุงูุชุฑุญูู
1. **ุฑุงุฌุน ุงูุจูุงูุงุช**: ุชุฃูุฏ ูู ุตุญุฉ ุงูุจุฑูุฏ ุงูุฅููุชุฑููู
2. **ุชุญูู ูู ุงููุฌุงู**: ุชุฃูุฏ ูู ุงุฎุชูุงุฑ ุงููุฌูุฉ ุงูุตุญูุญุฉ
3. **ุงุญูุธ ูููุงุช ุงููุฑูุฑ**: ุณุชุญุชุงุฌูุง ูุฅุฑุณุงููุง ููุฃุนุถุงุก

### โ ุจุนุฏ ุงูุชุฑุญูู
1. **ุฃุฑุณู ุจูุงูุงุช ุงูุฏุฎูู**: ุฃุฑุณู ุงูุจุฑูุฏ ููููุฉ ุงููุฑูุฑ ููุนุถู
2. **ุชุงุจุน ุงูุชุณุฌูู**: ุชุฃูุฏ ูู ุชุณุฌูู ุฏุฎูู ุงูุนุถู ุจูุฌุงุญ
3. **ุญุฏุซ ุงูุตูุงุญูุงุช**: ุนุฏู ุงูุฏูุฑ ุฃู ุงููุฌูุฉ ุฅุฐุง ูุฒู ุงูุฃูุฑ

### ๐ซ ูุง ูููู ุงูุชุฑุงุฌุน
- โ๏ธ **ุงูุชุฑุญูู ุนูููุฉ ููุงุฆูุฉ**
- โ๏ธ ูุง ูููู ุฅูุบุงุก ุงูุชุฑุญูู ุชููุงุฆูุงู
- โ๏ธ ูุญุฐู ุญุณุงุจ ูุฑุญูุ ุงุณุชุฎุฏู ูุณู "ุฅุฏุงุฑุฉ ุงููุณุชุฎุฏููู"

---

## ๐ ุฃูุซูุฉ ุนูููุฉ

### ูุซุงู 1: ุชุฑุญูู ุนุถู ูุงุญุฏ

```
1. ุฏุฎูู ูุณู "ุชุฑุญูู ุงูููุจูููู"
2. ุงูุจุญุซ ุนู "ุฃุญูุฏ ูุญูุฏ"
3. ุชุบููุฑ ุงููุฌูุฉ ูู "ุงููุนุงููุงุช" ุฅูู "ุงูุชุฃููู"
4. ุงูุถุบุท ุนูู "ุชุฑุญูู ุฅูู ุญุณุงุจ"
5. ุชุฃููุฏ ุงูุนูููุฉ
6. ูุณุฎ ูููุฉ ุงููุฑูุฑ: "Xy9#mK2pL8qR"
7. ุฅุฑุณุงู ุจุฑูุฏ ููุนุถู ูุน ุงูุจูุงูุงุช
```

### ูุซุงู 2: ุชุฑุญูู ุฏูุนุฉ

```
1. ุฏุฎูู ูุณู "ุชุฑุญูู ุงูููุจูููู"
2. ููุชุฑุฉ ุญุณุจ "ูุฌูุฉ ุงููุนุงููุงุช"
3. ุชุญุฏูุฏ 5 ุฃุนุถุงุก
4. ุงูุถุบุท ุนูู "ุชุฑุญูู ุงููุญุฏุฏูู (5)"
5. ุชุฃููุฏ ุงูุนูููุฉ
6. ุงูุชุธุงุฑ ุงููุชุงุฆุฌ
7. ูุณุฎ ูููุงุช ุงููุฑูุฑ ููู ุนุถู
8. ุฅุฑุณุงู ุจุฑูุฏ ุฌูุงุนู ุฃู ูุฑุฏู
```

---

## ๐ ุณูุฑ ุงูุนูู ุงููุงูู

```
1. ุงููุชูุฏู ููุฏู ุทูุจ ุนุถููุฉ
   โ
2. ุชุชู ูุฑุงุฌุนุฉ ุงูุทูุจ
   โ
3. ูุชู ูุจููู ููููุงุจูุฉ
   โ
4. ุชุฌุฑู ุงูููุงุจูุฉ
   โ
5. ูุชู ูุจููู ููุงุฆูุงู (result = 'accepted')
   โ
6. ูุธูุฑ ูู ูุณู "ูุชุงุฆุฌ ุงูุนุถููุฉ"
   โ
7. ูุธูุฑ ูู ูุณู "ุชุฑุญูู ุงูููุจูููู"
   โ
8. ุงููุณุคูู ูุฑุงุฌุน ููุนุฏู ุงููุฌูุฉ ุฅู ูุฒู
   โ
9. ุงููุณุคูู ูููู ุจุงูุชุฑุญูู
   โ
10. ูุชู ุฅูุดุงุก ุญุณุงุจ ูู auth.users
    โ
11. ูุชู ุฅูุดุงุก profile
    โ
12. ูุชู ุฑุจุทู ุจุฏูุฑ "ุนุถู ุนุงุฏู" ูุงููุฌูุฉ
    โ
13. ูุชู ุชุญุฏูุซ migrated_to_user_id
    โ
14. ูุธูุฑ ุงูุนุถู ูู "ุฅุฏุงุฑุฉ ุงููุณุชุฎุฏููู"
    โ
15. ูุณุชูู ุงูุนุถู ุจูุงูุงุช ุงูุฏุฎูู
    โ
16. ูุณุฌู ุฏุฎูู ููุบูุฑ ูููุฉ ุงููุฑูุฑ
```

---

## ๐ ุงูุฏุนู

ูู ุญุงูุฉ ูุฌูุฏ ูุดุงูู:
1. ุฑุงุฌุน logs ุงูู Edge Function ูู Supabase Dashboard
2. ุชุญูู ูู ุฌุฏูู `activity_log` ูุชุชุจุน ุงูุนูููุงุช
3. ุฑุงุฌุน ูุฐุง ุงูุฏููู ููุญููู ุงูุดุงุฆุนุฉ

---

## ๐ ุงูุฎูุงุตุฉ

ูุธุงู ุชุฑุญูู ุงุญุชุฑุงูู ููุชูุงูู ูููุฑ:
- โ ุณูููุฉ ูู ุงูุงุณุชุฎุฏุงู
- โ ุฃูุงู ุนุงูู
- โ ูุฑููุฉ ูู ุงูุชุนุฏูู
- โ ุชุชุจุน ูุงูู
- โ ุฏุนู ุงูุชุฑุญูู ุงููุฑุฏู ูุงูุฌูุงุนู

**ุชู ุชุตููู ุงููุธุงู ููููู ุขููุงู ูููุซููุงู ูุณูู ุงูุงุณุชุฎุฏุงู!** ๐
