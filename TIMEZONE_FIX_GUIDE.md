# ุฏููู ุฅุตูุงุญ ูุดููุฉ ุงูููุทูุฉ ุงูุฒูููุฉ ูู ูุธุงู ุงูุญุฌุฒ

## ๐ ุงููุดููุฉ

### **ุงูุฃุนุฑุงุถ:**
```
ุนูุฏ ุฅูุดุงุก ุฌูุณุฉ ููุงุจูุงุช:
- ุงูููุช ุงูููุฏุฎู: 09:00 ุตุจุงุญุงู
- ุงูููุช ุงููุนุฑูุถ ูู ุตูุญุฉ ุงูุญุฌูุฒุงุช: 12:00 ุธูุฑุงู

ุงููุฑู: 3 ุณุงุนุงุช โ๏ธ
```

### **ุงูุณุจุจ ุงูุฌุฐุฑู:**

ูู ุฏุงูุฉ `generate_interview_slots`ุ ุนูุฏ ุชุญููู `TIME` ุฅูู `TIMESTAMPTZ`:

```sql
-- ุงูููุฏ ุงููุฏูู (ุงููุดููุฉ)
current_slot_time := (p_session_date || ' ' || p_start_time)::TIMESTAMPTZ;
```

**ุงููุดููุฉ:**
- ุนูุฏ ุงูุชุญููู ุจุฏูู ุชุญุฏูุฏ ุงูููุทูุฉ ุงูุฒูููุฉุ ูุณุชุฎุฏู PostgreSQL ุงูููุทูุฉ ุงูุฒูููุฉ UTC ุงูุชุฑุงุถูุงู
- ุงูููุทูุฉ ุงูุฒูููุฉ ุงูุณุนูุฏูุฉ ูู UTC+3
- ูุฐููุ 09:00 ุจุชูููุช ุงูุณุนูุฏูุฉ = 06:00 UTC
- ุนูุฏ ุนุฑุถ 06:00 UTC ุจุชูููุช ุงูุณุนูุฏูุฉ = 09:00 + 3 = 12:00 ุธูุฑุงู โ

---

## โ ุงูุญู

### **ุงูุฅุตูุงุญ:**

```sql
-- ุงูููุฏ ุงูุฌุฏูุฏ (ุงูุญู)
current_slot_time := ((p_session_date || ' ' || p_start_time)::TIMESTAMP AT TIME ZONE 'Asia/Riyadh');
end_datetime := ((p_session_date || ' ' || p_end_time)::TIMESTAMP AT TIME ZONE 'Asia/Riyadh');
```

**ููู ูุนูู:**
1. `AT TIME ZONE 'Asia/Riyadh'` ูุญุฏุฏ ุฃู ุงูููุช ุงูููุฏุฎู ูู ุจุชูููุช ุงูุณุนูุฏูุฉ
2. ุงูุชุญููู ุฅูู `TIMESTAMPTZ` ูุญูุธ ุงูููุช ุจุดูู ุตุญูุญ
3. ุนูุฏ ุงูุนุฑุถุ ูุชู ุชุญูููู ุชููุงุฆูุงู ููููุทูุฉ ุงูุฒูููุฉ ุงููุญููุฉ

**ุงููุชูุฌุฉ:**
- ุงูููุช ุงูููุฏุฎู: 09:00 ุตุจุงุญุงู
- ุงูููุช ุงููุนุฑูุถ: 09:00 ุตุจุงุญุงู โ

---

## ๐ ุงูุชูุงุตูู ุงูุชูููุฉ

### **ูุจู ุงูุฅุตูุงุญ:**

```sql
-- ูุซุงู: ุฅูุดุงุก ุฌูุณุฉ ุชุจุฏุฃ 09:00 ุตุจุงุญุงู
p_session_date = '2026-01-25'
p_start_time = '09:00:00'

-- ุงูุชุญููู ุงููุฏูู
current_slot_time := ('2026-01-25 09:00:00')::TIMESTAMPTZ;
-- ุงููุชูุฌุฉ: 2026-01-25 09:00:00+00 (UTC)
-- ุนูุฏ ุงูุนุฑุถ ุจุชูููุช ุงูุณุนูุฏูุฉ: 12:00 ุธูุฑุงู โ
```

### **ุจุนุฏ ุงูุฅุตูุงุญ:**

```sql
-- ูุซุงู: ุฅูุดุงุก ุฌูุณุฉ ุชุจุฏุฃ 09:00 ุตุจุงุญุงู
p_session_date = '2026-01-25'
p_start_time = '09:00:00'

-- ุงูุชุญููู ุงูุฌุฏูุฏ
current_slot_time := (('2026-01-25 09:00:00')::TIMESTAMP AT TIME ZONE 'Asia/Riyadh');
-- ุงููุชูุฌุฉ: 2026-01-25 09:00:00+03 (Asia/Riyadh)
-- ุนูุฏ ุงูุนุฑุถ ุจุชูููุช ุงูุณุนูุฏูุฉ: 09:00 ุตุจุงุญุงู โ
```

---

## ๐ง ุงูุชุทุจูู

### **ุงูุฎุทูุฉ 1: ุชุทุจูู Migration 039**

```bash
cd supabase
supabase db push
```

**ุฃู ูุฏููุงู:**
```sql
-- ูู Supabase SQL Editor
-- ููุฐ ูุญุชูู: supabase/migrations/039_fix_timezone_issue.sql
```

---

### **ุงูุฎุทูุฉ 2: ุงูุชุญูู ูู ุงูุฅุตูุงุญ**

```sql
-- ุงูุชุญูู ูู ุชุญุฏูุซ ุงูุฏุงูุฉ
SELECT routine_name, routine_definition 
FROM information_schema.routines 
WHERE routine_name = 'generate_interview_slots';

-- ูุฌุจ ุฃู ูุญุชูู ุนูู: AT TIME ZONE 'Asia/Riyadh'
```

---

### **ุงูุฎุทูุฉ 3: ุฅุนุงุฏุฉ ุฅูุดุงุก ุงููุชุฑุงุช ููุฌูุณุงุช ุงูููุฌูุฏุฉ**

```sql
-- ููุฌูุณุงุช ุงูููุฌูุฏุฉุ ุฃุนุฏ ุฅูุดุงุก ุงููุชุฑุงุช
SELECT generate_interview_slots(
    id,
    session_date,
    start_time,
    end_time,
    slot_duration
)
FROM interview_sessions
WHERE is_active = true;
```

---

## ๐งช ุงูุงุฎุชุจุงุฑ

### **ุงุฎุชุจุงุฑ 1: ุฅูุดุงุก ุฌูุณุฉ ุฌุฏูุฏุฉ**

```
1. ุงูุชุญ ููุญุฉ ุงูุฅุฏุงุฑุฉ โ ุฌูุณุงุช ุงูููุงุจูุงุช
2. ุงุถุบุท "ุฅูุดุงุก ุฌูุณุฉ ุฌุฏูุฏุฉ"
3. ุฃุฏุฎู ุงูุจูุงูุงุช:
   - ุงูุชุงุฑูุฎ: ุบุฏุงู
   - ููุช ุงูุจุฏุงูุฉ: 09:00
   - ููุช ุงูููุงูุฉ: 12:00
   - ูุฏุฉ ุงูููุงุจูุฉ: 10 ุฏูุงุฆู
4. ุงุญูุธ ุงูุฌูุณุฉ โ

5. ุงูุชุญ ุฑุงุจุท ุงูุญุฌุฒ
6. ุชุญูู ูู ุงูุฃููุงุช ุงููุนุฑูุถุฉ:
   - โ ูุฌุจ ุฃู ุชุจุฏุฃ ูู 09:00 ุตุจุงุญุงู
   - โ ูููุณ 12:00 ุธูุฑุงู
```

---

### **ุงุฎุชุจุงุฑ 2: ุงูุชุญูู ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช**

```sql
-- ุฅูุดุงุก ุฌูุณุฉ ุชุฌุฑูุจูุฉ
INSERT INTO interview_sessions (
    session_name,
    session_date,
    start_time,
    end_time,
    slot_duration,
    interview_type,
    public_link_token,
    created_by
) VALUES (
    'ุฌูุณุฉ ุงุฎุชุจุงุฑ',
    CURRENT_DATE + 1,
    '09:00:00',
    '10:00:00',
    10,
    'online',
    'test-token-' || gen_random_uuid(),
    (SELECT id FROM profiles LIMIT 1)
);

-- ุงูุชุญูู ูู ุงููุชุฑุงุช ุงููููุดุฃุฉ
SELECT 
    slot_time,
    slot_time AT TIME ZONE 'Asia/Riyadh' as riyadh_time,
    to_char(slot_time AT TIME ZONE 'Asia/Riyadh', 'HH24:MI') as time_only
FROM interview_slots
WHERE session_id = (
    SELECT id FROM interview_sessions 
    WHERE session_name = 'ุฌูุณุฉ ุงุฎุชุจุงุฑ'
)
ORDER BY slot_time;

-- ุงููุชูุฌุฉ ุงููุชููุนุฉ:
-- time_only: 09:00, 09:10, 09:20, 09:30, 09:40, 09:50 โ
```

---

### **ุงุฎุชุจุงุฑ 3: ุงูุฌูุณุงุช ุงูููุฌูุฏุฉ**

```sql
-- ุนุฑุถ ุงูุฌูุณุงุช ุงูููุฌูุฏุฉ ูุน ุฃููุงุชูุง
SELECT 
    s.session_name,
    s.start_time,
    MIN(sl.slot_time AT TIME ZONE 'Asia/Riyadh') as first_slot,
    to_char(MIN(sl.slot_time AT TIME ZONE 'Asia/Riyadh'), 'HH24:MI') as first_slot_time
FROM interview_sessions s
LEFT JOIN interview_slots sl ON s.id = sl.session_id
WHERE s.is_active = true
GROUP BY s.id, s.session_name, s.start_time;

-- ุชุญูู ูู ุฃู first_slot_time ูุทุงุจู start_time
```

---

## ๐ ููุฎุต ุงูุชุบููุฑุงุช

| ุงููููู | ุงูุชุบููุฑ | ุงูุญุงูุฉ |
|--------|---------|--------|
| **ูุงุนุฏุฉ ุงูุจูุงูุงุช** |
| `generate_interview_slots()` | ุฅุถุงูุฉ `AT TIME ZONE 'Asia/Riyadh'` | โ |
| **Migration** |
| `039_fix_timezone_issue.sql` | ููู ุฌุฏูุฏ ููุฅุตูุงุญ | โ |
| `036_create_interview_booking_system.sql` | ุชุญุฏูุซ ุงูุฏุงูุฉ | โ |

---

## ๐ ููู ุงูููุทูุฉ ุงูุฒูููุฉ ูู PostgreSQL

### **ุฃููุงุน ุงูุจูุงูุงุช:**

```sql
-- TIME: ููุช ุจุฏูู ุชุงุฑูุฎ ุฃู ููุทูุฉ ุฒูููุฉ
start_time TIME  -- ูุซุงู: 09:00:00

-- TIMESTAMPTZ: ุชุงุฑูุฎ ูููุช ูุน ุงูููุทูุฉ ุงูุฒูููุฉ
slot_time TIMESTAMPTZ  -- ูุซุงู: 2026-01-25 09:00:00+03
```

### **ุงูุชุญููู:**

```sql
-- โ ุฎุทุฃ: ุจุฏูู ุชุญุฏูุฏ ุงูููุทูุฉ ุงูุฒูููุฉ
'2026-01-25 09:00:00'::TIMESTAMPTZ
-- ููุชุฑุถ UTCุ ููุชุฌ: 2026-01-25 09:00:00+00

-- โ ุตุญูุญ: ูุน ุชุญุฏูุฏ ุงูููุทูุฉ ุงูุฒูููุฉ
('2026-01-25 09:00:00'::TIMESTAMP AT TIME ZONE 'Asia/Riyadh')
-- ูุญุฏุฏ ุงูููุทูุฉ ุงูุณุนูุฏูุฉุ ููุชุฌ: 2026-01-25 09:00:00+03
```

### **ุงูููุงุทู ุงูุฒูููุฉ ุงููุฏุนููุฉ:**

```sql
-- ุนุฑุถ ุฌููุน ุงูููุงุทู ุงูุฒูููุฉ
SELECT name FROM pg_timezone_names 
WHERE name LIKE '%Riyadh%' OR name LIKE '%Saudi%';

-- ุงููุชูุฌุฉ:
-- Asia/Riyadh โ
```

---

## ๐ ุงูููุงุทู ุงูุฒูููุฉ ุงูุฃุฎุฑู

ุฅุฐุง ููุช ุชุณุชุฎุฏู ููุทูุฉ ุฒูููุฉ ุฃุฎุฑู:

```sql
-- ูุตุฑ (UTC+2)
AT TIME ZONE 'Africa/Cairo'

-- ุงูุฅูุงุฑุงุช (UTC+4)
AT TIME ZONE 'Asia/Dubai'

-- ุงููููุช (UTC+3)
AT TIME ZONE 'Asia/Kuwait'

-- ูุทุฑ (UTC+3)
AT TIME ZONE 'Asia/Qatar'

-- ุงูุจุญุฑูู (UTC+3)
AT TIME ZONE 'Asia/Bahrain'
```

---

## ๐ ุงุณุชูุดุงู ุงูุฃุฎุทุงุก

### **ุฎุทุฃ: ุงูููุช ูุง ูุฒุงู ุบูุฑ ุตุญูุญ ุจุนุฏ ุงูุฅุตูุงุญ**

```sql
-- ุงูุญู: ุฃุนุฏ ุฅูุดุงุก ุงููุชุฑุงุช ููุฌูุณุงุช ุงูููุฌูุฏุฉ
SELECT generate_interview_slots(
    id,
    session_date,
    start_time,
    end_time,
    slot_duration
)
FROM interview_sessions
WHERE is_active = true;
```

---

### **ุฎุทุฃ: "time zone 'Asia/Riyadh' not recognized"**

```sql
-- ุงูุญู: ุชุญูู ูู ุงูููุงุทู ุงูุฒูููุฉ ุงููุชุงุญุฉ
SELECT * FROM pg_timezone_names WHERE name = 'Asia/Riyadh';

-- ุฅุฐุง ูู ุชูู ููุฌูุฏุฉุ ุงุณุชุฎุฏู UTC ูุน ุงูุฅุฒุงุญุฉ
AT TIME ZONE 'UTC+3'
```

---

### **ุฎุทุฃ: ุงูููุช ูุชุบูุฑ ุนูุฏ ุงูุชูููุช ุงูุตููู**

```
ููุงุญุธุฉ: ุงูุณุนูุฏูุฉ ูุง ุชุณุชุฎุฏู ุงูุชูููุช ุงูุตููู
ูุฐููุ 'Asia/Riyadh' ุฏุงุฆูุงู UTC+3 โ
```

---

## ๐ ุงููููุงุช ุงูููุนุฏููุฉ ูุงูุฌุฏูุฏุฉ

### **ููุนุฏูู:**
- โ `supabase/migrations/036_create_interview_booking_system.sql`
  - ุชุญุฏูุซ ุฏุงูุฉ `generate_interview_slots()`

### **ุฌุฏูุฏ:**
- โ `supabase/migrations/039_fix_timezone_issue.sql`
- โ `TIMEZONE_FIX_GUIDE.md` (ูุฐุง ุงูููู)

---

## ๐ก ูุตุงุฆุญ ูููุณุชูุจู

### **1. ุงุณุชุฎุฏู ุฏุงุฆูุงู ุงูููุทูุฉ ุงูุฒูููุฉ ุนูุฏ ุงูุชุญููู:**

```sql
-- โ ุชุฌูุจ
'2026-01-25 09:00:00'::TIMESTAMPTZ

-- โ ุงุณุชุฎุฏู
('2026-01-25 09:00:00'::TIMESTAMP AT TIME ZONE 'Asia/Riyadh')
```

---

### **2. ุงุฎุชุจุฑ ุงูุฃููุงุช ุฏุงุฆูุงู:**

```sql
-- ุงุฎุชุจุงุฑ ุณุฑูุน
SELECT 
    '09:00:00'::TIME as input_time,
    ('2026-01-25 09:00:00')::TIMESTAMPTZ as without_tz,
    (('2026-01-25 09:00:00') AT TIME ZONE 'Asia/Riyadh')::TIMESTAMPTZ as with_tz;
```

---

### **3. ูุซูู ุงูููุทูุฉ ุงูุฒูููุฉ ุงููุณุชุฎุฏูุฉ:**

```sql
-- ูู ุจุฏุงูุฉ ุงูููู
-- ุงูููุทูุฉ ุงูุฒูููุฉ: Asia/Riyadh (UTC+3)
```

---

## โจ ุงูุฎูุงุตุฉ

ุชู ุฅุตูุงุญ ูุดููุฉ ุงูููุทูุฉ ุงูุฒูููุฉ ุจูุฌุงุญ:

1. โ **ุงูุณุจุจ:** ุนุฏู ุชุญุฏูุฏ ุงูููุทูุฉ ุงูุฒูููุฉ ุนูุฏ ุงูุชุญููู
2. โ **ุงูุญู:** ุฅุถุงูุฉ `AT TIME ZONE 'Asia/Riyadh'`
3. โ **ุงููุชูุฌุฉ:** ุงูุฃููุงุช ุชูุนุฑุถ ุจุดูู ุตุญูุญ

**ูุจู ุงูุฅุตูุงุญ:**
- 09:00 ุตุจุงุญุงู โ 12:00 ุธูุฑุงู โ

**ุจุนุฏ ุงูุฅุตูุงุญ:**
- 09:00 ุตุจุงุญุงู โ 09:00 ุตุจุงุญุงู โ

**ุงููุธุงู ุฌุงูุฒ ููุงุณุชุฎุฏุงู!** ๐
