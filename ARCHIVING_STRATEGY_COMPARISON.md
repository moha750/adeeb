# ููุงุฑูุฉ ุงุณุชุฑุงุชูุฌูุงุช ุงูุฃุฑุดูุฉ

## ๐ฏ ูุฏูู ุงูุฃุณุงุณู
> ุญุฐู ุฌููุน ุงูุจูุงูุงุช ุงููุฎุฒูุฉ ูู ุงูุฃูุณุงู ูููููุง ูุชุฎุฒูููุง ูู ุฃุฑุดูู ุงูุชุณุฌูู ุญุชู ุชุณุชุทูุน ูุชุญ ุจุงุจ ุงูุชุณุฌูู ูุฑุฉ ุฃุฎุฑู ูุงุณุชูุจุงู ุจูุงูุงุช ุฌุฏูุฏุฉ ุฏูู ูุฌูุฏ ุดูุก ูุฏูู.

---

## ๐ ููุงุฑูุฉ ุจูู ุงูุงุณุชุฑุงุชูุฌูุชูู

### ุงูุงุณุชุฑุงุชูุฌูุฉ 1๏ธโฃ: ุงูุฃุฑุดูุฉ ุงูุชุฏุฑูุฌูุฉ (ุงููุธุงู ุงูุญุงูู)

#### **ุงูููุฑุฉ:**
- ุฃุฑุดูุฉ ุชุฏุฑูุฌูุฉ ููู ูุฑุญูุฉ ูู ูุฑุงุญู ุงูุชุณุฌูู
- ุฅูุดุงุก ููุทุงุช (snapshots) ุนูุฏ ูู ูุฑุญูุฉ
- ุงูุจูุงูุงุช ุชุจูู ูู ุงูุฌุฏุงูู ุงูุฃุตููุฉ ูุน ุฑุจุทูุง ุจู `cycle_id`

#### **ุงููุฒุงูุง:**
- โ ุชุชุจุน ุชูุตููู ููู ูุฑุญูุฉ
- โ ุฅููุงููุฉ ุงูุฑุฌูุน ูุฃู ูุฑุญูุฉ
- โ ูุฑููุฉ ูู ุฅุฏุงุฑุฉ ุงูุฏูุฑุงุช ุงููุชุนุฏุฏุฉ
- โ ุชุญูููุงุช ูููุงุฑูุงุช ุฏูููุฉ

#### **ุงูุนููุจ:**
- โ ุงูุจูุงูุงุช ุงููุฏููุฉ ุชุจูู ูู ุงูุฌุฏุงูู ุงูุฑุฆูุณูุฉ
- โ ูุฏ ุชุคุซุฑ ุนูู ุงูุฃุฏุงุก ูุน ุงูููุช
- โ **ูุง ุชุญูู ูุฏูู ุงูุฃุณุงุณู** (ุญุฐู ุงูุจูุงูุงุช ุงููุฏููุฉ)
- โ ุชุนููุฏ ูู ุงูุงุณุชุนูุงูุงุช (ุชุญุชุงุฌ ููุชุฑุฉ ุจู cycle_id)

#### **ููุงุณุจุฉ ูู:**
- ุงููุคุณุณุงุช ุงูุชู ุชุญุชุงุฌ ุชุญูููุงุช ุชุงุฑูุฎูุฉ ููุตูุฉ
- ุนูุฏ ุงูุญุงุฌุฉ ูููุงุฑูุฉ ุฏูุฑุงุช ูุชุนุฏุฏุฉ
- ุนูุฏูุง ูููู ุงูุฃุฏุงุก ููุณ ูุดููุฉ

---

### ุงูุงุณุชุฑุงุชูุฌูุฉ 2๏ธโฃ: ุงูุฃุฑุดูุฉ ุงููุงููุฉ ุจููุฑุฉ ูุงุญุฏุฉ (ุงูููุชุฑุญ ูู)

#### **ุงูููุฑุฉ:**
- ุฒุฑ "ุฃุฑุดูุฉ ุงูุชุณุฌูู" ูู ููุญุฉ ุงูุชุญูู
- ููู ุฌููุน ุงูุจูุงูุงุช ุฏูุนุฉ ูุงุญุฏุฉ ุฅูู ุฌุฏุงูู ุฃุฑุดูู ูููุตูุฉ
- ุญุฐู ุงูุจูุงูุงุช ูู ุงูุฌุฏุงูู ุงูุฑุฆูุณูุฉ
- ุงูุฌุฏุงูู ุงูุฑุฆูุณูุฉ ุชุตุจุญ ูุงุฑุบุฉ ูุฌุงูุฒุฉ ูุฏูุฑุฉ ุฌุฏูุฏุฉ

#### **ุงููุฒุงูุง:**
- โ **ูุญูู ูุฏูู ุจุงูุถุจุท** (ุญุฐู ุงูุจูุงูุงุช ุงููุฏููุฉ)
- โ ุจุณูุท ูุณูู ุงูุงุณุชุฎุฏุงู (ุฒุฑ ูุงุญุฏ)
- โ ุฃุฏุงุก ููุชุงุฒ (ุฌุฏุงูู ุฑุฆูุณูุฉ ูุธููุฉ)
- โ ูุง ุชุนููุฏ ูู ุงูุงุณุชุนูุงูุงุช
- โ ูุงุถุญ ููุจุงุดุฑ

#### **ุงูุนููุจ:**
- โ๏ธ ูุง ูููู ุงูุชุฑุงุฌุน ุจุณูููุฉ (ูุญุชุงุฌ restore)
- โ๏ธ ุชุญุชุงุฌ ุฌุฏุงูู ุฃุฑุดูู ูููุตูุฉ
- โ๏ธ ุงูููุงุฑูุงุช ุจูู ุงูุฏูุฑุงุช ุชุญุชุงุฌ ุงุณุชุนูุงูุงุช ูู ุฌุฏุงูู ูุฎุชููุฉ

#### **ููุงุณุจุฉ ูู:**
- **ุญุงูุชู ุจุงูุถุจุท** โ
- ุนูุฏูุง ุชุฑูุฏ ุจุฏุงูุฉ ูุธููุฉ ููู ุฏูุฑุฉ
- ุนูุฏูุง ุงูุฃุฏุงุก ููู
- ุนูุฏูุง ูุง ุชุญุชุงุฌ ุชุญูููุงุช ุชุงุฑูุฎูุฉ ูุนูุฏุฉ

---

## ๐ฏ ุงูุชูุตูุฉ: ุงูุงุณุชุฑุงุชูุฌูุฉ ุงูุซุงููุฉ (ุงูุฃุฑุดูุฉ ุงููุงููุฉ)

### ููุงุฐุงุ
1. **ุชุญูู ูุฏูู ุงูุฃุณุงุณู** - ุญุฐู ุงูุจูุงูุงุช ุงููุฏููุฉ ุจุงููุงูู
2. **ุจุณุงุทุฉ ุงูุงุณุชุฎุฏุงู** - ุฒุฑ ูุงุญุฏ ุจุฏูุงู ูู ุนุฏุฉ ุฎุทูุงุช
3. **ุฃุฏุงุก ุฃูุถู** - ุฌุฏุงูู ุฑุฆูุณูุฉ ูุธููุฉ ุฏุงุฆูุงู
4. **ูุถูุญ** - ูู ุฏูุฑุฉ ููุง ุจูุงูุงุช ูููุตูุฉ ุชูุงูุงู

---

## ๐๏ธ ุงูุชุตููู ุงูููุชุฑุญ ููุฃุฑุดูุฉ ุงููุงููุฉ

### 1. ุฌุฏุงูู ุงูุฃุฑุดูู ุงููููุตูุฉ

```sql
-- ุฌุฏูู ุฃุฑุดูู ุงูุทูุจุงุช
CREATE TABLE membership_applications_archive (
    id UUID PRIMARY KEY,
    cycle_id UUID NOT NULL REFERENCES membership_cycles(id),
    -- ุฌููุน ุฃุนูุฏุฉ membership_applications
    full_name TEXT,
    email TEXT,
    phone TEXT,
    -- ... ุจุงูู ุงูุฃุนูุฏุฉ
    archived_at TIMESTAMPTZ DEFAULT NOW()
);

-- ุฌุฏูู ุฃุฑุดูู ุงูููุงุจูุงุช
CREATE TABLE membership_interviews_archive (
    id UUID PRIMARY KEY,
    cycle_id UUID NOT NULL REFERENCES membership_cycles(id),
    application_id UUID NOT NULL,
    -- ุฌููุน ุฃุนูุฏุฉ membership_interviews
    interview_date TIMESTAMPTZ,
    status TEXT,
    result TEXT,
    -- ... ุจุงูู ุงูุฃุนูุฏุฉ
    archived_at TIMESTAMPTZ DEFAULT NOW()
);

-- ุฌุฏูู ุฃุฑุดูู ุฌูุณุงุช ุงูููุงุจูุงุช
CREATE TABLE interview_sessions_archive (
    id UUID PRIMARY KEY,
    cycle_id UUID NOT NULL REFERENCES membership_cycles(id),
    -- ุฌููุน ุฃุนูุฏุฉ interview_sessions
    session_name TEXT,
    session_date TIMESTAMPTZ,
    -- ... ุจุงูู ุงูุฃุนูุฏุฉ
    archived_at TIMESTAMPTZ DEFAULT NOW()
);
```

### 2. ุฏุงูุฉ ุงูุฃุฑุดูุฉ ุงููุงููุฉ

```sql
CREATE OR REPLACE FUNCTION archive_membership_cycle(
    p_cycle_name TEXT,
    p_cycle_year INTEGER,
    p_cycle_season TEXT,
    p_archived_by UUID
)
RETURNS UUID AS $$
DECLARE
    v_cycle_id UUID;
    v_applications_count INTEGER;
    v_interviews_count INTEGER;
    v_sessions_count INTEGER;
BEGIN
    -- 1. ุฅูุดุงุก ุณุฌู ุงูุฏูุฑุฉ
    INSERT INTO membership_cycles (
        cycle_name,
        cycle_year,
        cycle_season,
        status,
        archived_at,
        archived_by
    ) VALUES (
        p_cycle_name,
        p_cycle_year,
        p_cycle_season,
        'archived',
        NOW(),
        p_archived_by
    )
    RETURNING id INTO v_cycle_id;
    
    -- 2. ููู ุงูุทูุจุงุช ุฅูู ุงูุฃุฑุดูู
    INSERT INTO membership_applications_archive
    SELECT 
        id,
        v_cycle_id as cycle_id,
        full_name,
        email,
        phone,
        preferred_committee,
        status,
        created_at,
        -- ... ุฌููุน ุงูุฃุนูุฏุฉ
        NOW() as archived_at
    FROM membership_applications;
    
    GET DIAGNOSTICS v_applications_count = ROW_COUNT;
    
    -- 3. ููู ุงูููุงุจูุงุช ุฅูู ุงูุฃุฑุดูู
    INSERT INTO membership_interviews_archive
    SELECT 
        id,
        v_cycle_id as cycle_id,
        application_id,
        interview_date,
        status,
        result,
        notes,
        -- ... ุฌููุน ุงูุฃุนูุฏุฉ
        NOW() as archived_at
    FROM membership_interviews;
    
    GET DIAGNOSTICS v_interviews_count = ROW_COUNT;
    
    -- 4. ููู ุฌูุณุงุช ุงูููุงุจูุงุช ุฅูู ุงูุฃุฑุดูู
    INSERT INTO interview_sessions_archive
    SELECT 
        id,
        v_cycle_id as cycle_id,
        session_name,
        session_date,
        -- ... ุฌููุน ุงูุฃุนูุฏุฉ
        NOW() as archived_at
    FROM interview_sessions;
    
    GET DIAGNOSTICS v_sessions_count = ROW_COUNT;
    
    -- 5. ุญุฐู ุงูุจูุงูุงุช ูู ุงูุฌุฏุงูู ุงูุฑุฆูุณูุฉ
    DELETE FROM membership_interviews;
    DELETE FROM membership_applications;
    DELETE FROM interview_sessions;
    
    -- 6. ุชุญุฏูุซ ุฅุญุตุงุฆูุงุช ุงูุฏูุฑุฉ
    UPDATE membership_cycles
    SET 
        total_applications = v_applications_count,
        interviewed_count = v_interviews_count
    WHERE id = v_cycle_id;
    
    -- 7. ุฅูุดุงุก ููุทุฉ ููุงุฆูุฉ
    PERFORM create_cycle_snapshot(
        v_cycle_id,
        'final_decisions',
        p_archived_by,
        format('ุฃุฑุดูุฉ ูุงููุฉ - %s ุทูุจุ %s ููุงุจูุฉุ %s ุฌูุณุฉ', 
               v_applications_count, v_interviews_count, v_sessions_count)
    );
    
    RETURN v_cycle_id;
END;
$$ LANGUAGE plpgsql;
```

### 3. ูุงุฌูุฉ ุงููุณุชุฎุฏู

```javascript
// ูู ุตูุญุฉ ุฅุนุฏุงุฏุงุช ุงูุชุณุฌูู
async function archiveMembershipCycle() {
    // ูุงูุฐุฉ ุชุฃููุฏ
    const confirmed = await showConfirmDialog({
        title: 'ุฃุฑุดูุฉ ุงูุชุณุฌูู',
        message: `
            <div style="text-align: right; line-height: 1.8;">
                <p><strong>โ๏ธ ุชุญุฐูุฑ ููู:</strong></p>
                <p>ูุฐุง ุงูุฅุฌุฑุงุก ุณูููู ุจู:</p>
                <ul style="text-align: right;">
                    <li>ููู ุฌููุน ุงูุทูุจุงุช ุฅูู ุงูุฃุฑุดูู</li>
                    <li>ููู ุฌููุน ุงูููุงุจูุงุช ุฅูู ุงูุฃุฑุดูู</li>
                    <li>ููู ุฌููุน ุงูุฌูุณุงุช ุฅูู ุงูุฃุฑุดูู</li>
                    <li><strong style="color: #ef4444;">ุญุฐู ุฌููุน ุงูุจูุงูุงุช ูู ุงูุฃูุณุงู ุงูุญุงููุฉ</strong></li>
                </ul>
                <p><strong>ูู ุชุชููู ูู ุงูุชุฑุงุฌุน ุนู ูุฐุง ุงูุฅุฌุฑุงุก!</strong></p>
                <p>ูู ุฃูุช ูุชุฃูุฏ ูู ุงูุฃุฑุดูุฉุ</p>
            </div>
        `,
        confirmText: 'ูุนูุ ุฃุฑุดู ุงูุขู',
        cancelText: 'ุฅูุบุงุก',
        type: 'danger'
    });
    
    if (!confirmed) return;
    
    // ูุงูุฐุฉ ุฅุฏุฎุงู ุงุณู ุงูุฏูุฑุฉ
    const cycleName = await showInputDialog({
        title: 'ุงุณู ุงูุฏูุฑุฉ',
        message: 'ุฃุฏุฎู ุงุณู ุงูุฏูุฑุฉ ููุฃุฑุดูู (ูุซุงู: ุฏูุฑุฉ ุงูุชุณุฌูู - ุฎุฑูู 1446)',
        placeholder: 'ุฏูุฑุฉ ุงูุชุณุฌูู - ุฎุฑูู 1446',
        required: true
    });
    
    if (!cycleName) return;
    
    try {
        showLoading(true);
        
        // ุงุณุชุฏุนุงุก ุฏุงูุฉ ุงูุฃุฑุดูุฉ
        const { data, error } = await supabase.rpc('archive_membership_cycle', {
            p_cycle_name: cycleName,
            p_cycle_year: 1446, // ุฃู ูู ุฅุฏุฎุงู ุงููุณุชุฎุฏู
            p_cycle_season: 'fall', // ุฃู ูู ุฅุฏุฎุงู ุงููุณุชุฎุฏู
            p_archived_by: currentUser.id
        });
        
        if (error) throw error;
        
        showNotification('ุชูุช ุงูุฃุฑุดูุฉ ุจูุฌุงุญ! ุงูุฃูุณุงู ุงูุขู ูุงุฑุบุฉ ูุฌุงูุฒุฉ ูุฏูุฑุฉ ุฌุฏูุฏุฉ.', 'success');
        
        // ุฅุนุงุฏุฉ ุชุญููู ุฌููุน ุงูุฃูุณุงู
        await reloadAllSections();
        
    } catch (error) {
        console.error('ุฎุทุฃ ูู ุงูุฃุฑุดูุฉ:', error);
        showNotification('ุญุฏุซ ุฎุทุฃ ุฃุซูุงุก ุงูุฃุฑุดูุฉ', 'error');
    } finally {
        showLoading(false);
    }
}
```

### 4. ุฒุฑ ุงูุฃุฑุดูุฉ ูู ุงููุงุฌูุฉ

```html
<!-- ูู ุตูุญุฉ ุฅุนุฏุงุฏุงุช ุงูุชุณุฌูู -->
<div class="card">
    <div class="card-header">
        <h3>
            <i class="fa-solid fa-box-archive"></i>
            ุฃุฑุดูุฉ ุงูุชุณุฌูู
        </h3>
    </div>
    <div class="card-body">
        <div class="alert alert-warning">
            <i class="fa-solid fa-exclamation-triangle"></i>
            <strong>ุชูุจูู:</strong> ุงูุฃุฑุดูุฉ ุณุชููู ุฌููุน ุงูุจูุงูุงุช ุงูุญุงููุฉ ุฅูู ุงูุฃุฑุดูู ูุชุญุฐููุง ูู ุงูุฃูุณุงูุ 
            ููุง ูุฌุนู ุงููุธุงู ุฌุงูุฒุงู ูุฏูุฑุฉ ุชุณุฌูู ุฌุฏูุฏุฉ.
        </div>
        
        <div class="stats-row" style="margin: 1.5rem 0;">
            <div class="stat-item">
                <div class="stat-label">ุงูุทูุจุงุช ุงูุญุงููุฉ</div>
                <div class="stat-value" id="currentApplicationsCount">0</div>
            </div>
            <div class="stat-item">
                <div class="stat-label">ุงูููุงุจูุงุช ุงูุญุงููุฉ</div>
                <div class="stat-value" id="currentInterviewsCount">0</div>
            </div>
            <div class="stat-item">
                <div class="stat-label">ุงูุฌูุณุงุช ุงูุญุงููุฉ</div>
                <div class="stat-value" id="currentSessionsCount">0</div>
            </div>
        </div>
        
        <button 
            class="btn btn-danger" 
            onclick="archiveMembershipCycle()"
            style="width: 100%;">
            <i class="fa-solid fa-box-archive"></i>
            ุฃุฑุดูุฉ ุงูุชุณุฌูู ุงูุญุงูู
        </button>
    </div>
</div>
```

---

## ๐ ุณูุฑ ุงูุนูู ุงูููุชุฑุญ

### ุงูุณููุงุฑูู ุงููุงูู:

1. **ุฏูุฑุฉ ุงูุชุณุฌูู ุงูุฃููู:**
   - ูุชุญ ุจุงุจ ุงูุชุณุฌูู
   - ุงุณุชูุจุงู ุงูุทูุจุงุช
   - ุงููุฑุงุฌุนุฉ ูุงูููุงุจูุงุช
   - ุงููุฑุงุฑุงุช ุงูููุงุฆูุฉ
   - **ุงูุถุบุท ุนูู "ุฃุฑุดูุฉ ุงูุชุณุฌูู"** โ
   - ุฌููุน ุงูุจูุงูุงุช ุชูููู ููุฃุฑุดูู
   - ุงูุฃูุณุงู ุชุตุจุญ ูุงุฑุบุฉ

2. **ุฏูุฑุฉ ุงูุชุณุฌูู ุงูุซุงููุฉ:**
   - ูุชุญ ุจุงุจ ุงูุชุณุฌูู ูุฑุฉ ุฃุฎุฑู
   - ุงุณุชูุจุงู ุทูุจุงุช ุฌุฏูุฏุฉ (ุงูุฃูุณุงู ูุงุฑุบุฉ โ)
   - ุงููุฑุงุฌุนุฉ ูุงูููุงุจูุงุช
   - ุงููุฑุงุฑุงุช ุงูููุงุฆูุฉ
   - **ุงูุถุบุท ุนูู "ุฃุฑุดูุฉ ุงูุชุณุฌูู"** โ
   - ุฌููุน ุงูุจูุงูุงุช ุชูููู ููุฃุฑุดูู
   - ุงูุฃูุณุงู ุชุตุจุญ ูุงุฑุบุฉ ูุฑุฉ ุฃุฎุฑู

3. **ุนุฑุถ ุงูุฃุฑุดูู:**
   - ุตูุญุฉ "ุฃุฑุดูู ุงูุชุณุฌูู"
   - ุนุฑุถ ุฌููุน ุงูุฏูุฑุงุช ุงููุคุฑุดูุฉ
   - ุฅููุงููุฉ ุนุฑุถ ุชูุงุตูู ูู ุฏูุฑุฉ
   - ุฅููุงููุฉ ุชุตุฏูุฑ ุงูุจูุงูุงุช

---

## ๐ ููุงุฑูุฉ ููุงุฆูุฉ

| ุงูููุฒุฉ | ุงูุฃุฑุดูุฉ ุงูุชุฏุฑูุฌูุฉ | ุงูุฃุฑุดูุฉ ุงููุงููุฉ |
|--------|-------------------|-----------------|
| **ุญุฐู ุงูุจูุงูุงุช ุงููุฏููุฉ** | โ ูุง | โ ูุนู |
| **ุจุฏุงูุฉ ูุธููุฉ** | โ ูุง | โ ูุนู |
| **ุณูููุฉ ุงูุงุณุชุฎุฏุงู** | โ๏ธ ูุชูุณุท | โ ุณูู ุฌุฏุงู |
| **ุงูุฃุฏุงุก** | โ๏ธ ูุชุฃุซุฑ ูุน ุงูููุช | โ ููุชุงุฒ ุฏุงุฆูุงู |
| **ุชุชุจุน ุงููุฑุงุญู** | โ ุชูุตููู | โ๏ธ ุนุงู |
| **ุงูุชุญูููุงุช ุงูุชุงุฑูุฎูุฉ** | โ ุณููุฉ | โ๏ธ ุชุญุชุงุฌ ุงุณุชุนูุงูุงุช ุฎุงุตุฉ |
| **ูุญูู ูุฏูู** | โ ูุง | โ ูุนู |

---

## ๐ฏ ุงูุชูุตูุฉ ุงูููุงุฆูุฉ

### **ุงุณุชุฎุฏู ุงูุงุณุชุฑุงุชูุฌูุฉ ุงูุซุงููุฉ (ุงูุฃุฑุดูุฉ ุงููุงููุฉ)** โ

**ุงูุณุจุจ:**
- ุชุญูู ูุฏูู ุจุงูุถุจุท
- ุจุณูุทุฉ ููุจุงุดุฑุฉ
- ุฃุฏุงุก ููุชุงุฒ
- ูุงุถุญุฉ ูููุณุชุฎุฏููู

### **ุฎุทุฉ ุงูุชูููุฐ:**

1. โ ุฅูุดุงุก ุฌุฏุงูู ุงูุฃุฑุดูู ุงููููุตูุฉ
2. โ ุฅูุดุงุก ุฏุงูุฉ `archive_membership_cycle()`
3. โ ุฅุถุงูุฉ ุฒุฑ "ุฃุฑุดูุฉ ุงูุชุณุฌูู" ูู ุฅุนุฏุงุฏุงุช ุงูุชุณุฌูู
4. โ ุชุทููุฑ ุตูุญุฉ "ุฃุฑุดูู ุงูุชุณุฌูู" ูุนุฑุถ ุงูุฏูุฑุงุช ุงููุคุฑุดูุฉ
5. โ ุฅุถุงูุฉ ูุงูุฐุฉ ุชุฃููุฏ ูููุฉ ูุจู ุงูุฃุฑุดูุฉ

---

## ๐ก ููุงุญุธุฉ ูููุฉ

ููููู ุงูุงุญุชูุงุธ ุจุฌุฏูู `membership_cycles` ูู ุงููุธุงู ุงูุณุงุจู ูุชุณุฌูู ูุนูููุงุช ุงูุฏูุฑุฉ (ุงูุชูุงุฑูุฎุ ุงูุฅุญุตุงุฆูุงุช)ุ ููู ุงูุจูุงูุงุช ุงููุนููุฉ (ุงูุทูุจุงุชุ ุงูููุงุจูุงุช) ุณุชููู ูู ุฌุฏุงูู ุงูุฃุฑุดูู ุงููููุตูุฉ.

ูุฐุง ูุนุทูู:
- โ ุณุฌู ุชุงุฑูุฎู ููุฏูุฑุงุช
- โ ุฅุญุตุงุฆูุงุช ุนุงูุฉ
- โ ุฌุฏุงูู ุฑุฆูุณูุฉ ูุธููุฉ
- โ ุฃูุถู ูุง ูู ุงูุงุณุชุฑุงุชูุฌูุชูู
