<!doctype html>
<html dir="rtl" lang="ar">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>ØªØ³Ø¬ÙŠÙ„ Ø¹Ø¶ÙˆÙŠØ© Ù†Ø§Ø¯ÙŠ Ø£Ø¯ÙŠØ¨</title>
    <meta name="robots" content="noindex, nofollow" />
    <meta name="googlebot" content="noindex, nofollow" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/7.0.1/css/all.min.css" integrity="sha512-2SwdPD6INVrV/lHTZbO2nodKhrnDdJK9/kg2XD1r9uGqPo1cUbujc+IYdlYdEErWNu69gVcYgdxlmVmzTWnetw==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <link rel="stylesheet" href="style.css" />
    <style>
      body { min-height:100vh; display:grid; place-items:center; background:linear-gradient(135deg, #f8f9fa 0%, #e6f0f9 100%); color:#274060; font-family: fl; align-content: center;}
      .card { width:min(760px, 96vw); background:#ffffff; border:1px solid rgba(61,143,214,0.15); border-radius:16px; padding:24px; box-shadow:0 10px 30px rgba(39,64,96,0.08), 0 4px 12px rgba(39,64,96,0.06); }
      .card.closed-state { background: transparent !important; border: none !important; box-shadow: none !important; padding: 0 !important; }
      header { display:flex; flex-direction:column; align-items:center; gap:12px; margin-bottom:10px; text-align:center; }
      header img { width:10rem; }
      h1 { font-size:1.45rem; margin:0; color:#274060; font-family: fb; }
      p.muted { color:#335c81; margin:6px 0 0; font-size:.95rem; }
      .steps { display:flex; align-items:center; gap:8px; margin:14px 0 18px; }
      .step { display:flex; flex-direction:column; align-items:center; gap:6px; color:#5b708d; }
      .step .dot { width:26px; height:26px; display:grid; place-items:center; border-radius:50%; background:#ffffff; border:1px solid rgba(61,143,214,0.35); color:#274060; font-size:.9rem; transition: background-color .2s ease, color .2s ease, border-color .2s ease; transform:none; }
      .step.active .dot { background:linear-gradient(135deg, #3d8fd6, #274060); border-color:transparent; color:#fff; }
      .step.done .dot { background:#16a34a; border-color:#16a34a; color:transparent; position:relative; }
      .step.done .dot::after { content:'\2713'; position:absolute; inset:0; display:grid; place-items:center; color:#fff; font-size:.95rem; }
      .step .label { font-size:.92rem; text-align:center; line-height:1.2; }
      .sep { flex:1; height:2px; background:linear-gradient(90deg, rgba(61,143,214,0.25), rgba(39,64,96,0.25)); border-radius:2px; }
      form { display:block; }
      .step-pane { display:none; }
      .step-pane.active { display:block; }
      .grid { display:grid; gap:12px; grid-template-columns:1fr; }
      @media (min-width:720px){ .grid.two { grid-template-columns:1fr 1fr; } }
      label { display:grid; gap:6px; font-size:.95rem; color:#274060; }
      input[type=text], input[type=tel], input[type=email], input[type=url], select, textarea { background:#ffffff; color:#274060; border:1px solid #e2e8f0; border-radius:10px; padding:12px 14px; }
      textarea { min-height:120px; resize:vertical; }
      .actions { display:flex; justify-content:center; align-items:center; gap:12px; margin-top:12px; }
      .actions .left { display:flex; gap:10px; align-items:center; }
      .btn { -webkit-appearance:none; appearance:none; display:inline-flex; align-items:center; justify-content:center; gap:8px; padding:10px 16px; border-radius:12px; font-family: fb; font-size:14px; line-height:1; text-decoration:none; cursor:pointer; border:1px solid transparent; color:#1a2a3a; background:#fff; transition: transform .15s ease, background-color .2s ease, color .2s ease, box-shadow .2s ease, border-color .2s ease; user-select:none; }
      .btn i { font-size:.95em; }
      .btn:disabled, .btn[aria-disabled="true"] { opacity:.6; cursor:not-allowed; pointer-events:none; }
      .btn:focus-visible { outline:none; box-shadow:0 0 0 4px rgba(61,143,214,0.18); }
      .btn-primary { color:#fff; background:linear-gradient(135deg, var(--accent-blue), var(--main-blue)); border-color: rgba(61,143,214,0.35); box-shadow:0 8px 18px rgba(61,143,214,0.25), inset 0 1px 0 rgba(255,255,255,0.25); transition: all 0.5s; }
      .btn-primary:hover { transform: translateY(-1px); box-shadow:0 10px 22px rgba(61,143,214,0.3), inset 0 1px 0 rgba(255,255,255,0.25); filter: brightness(1.02); }
      .btn-primary:active { transform: translateY(0); box-shadow:0 6px 14px rgba(61,143,214,0.24) inset; }
      .btn-outline { color: var(--main-blue); background: linear-gradient(180deg, rgba(255,255,255,0.96), rgba(249,251,255,0.98)); border-color: rgba(61,143,214,0.35); box-shadow: 0 1px 0 rgba(255,255,255,0.8) inset, 0 2px 10px rgba(39,64,96,0.06); transition: all 0.5s; }
      .btn-outline:hover { color:#fff; background: linear-gradient(135deg, var(--accent-blue), #5aa9e6); border-color: rgba(61,143,214,0.5); transform: translateY(-1px); box-shadow: 0 8px 18px rgba(61,143,214,0.2); }
      .btn-outline:active { transform: translateY(0); box-shadow: 0 5px 12px rgba(61,143,214,0.18) inset; }
      .alert { background:rgba(61,143,214,0.08); border:1px solid rgba(61,143,214,0.25); color:#274060; padding:10px 12px; border-radius:10px; display:none; }
      .error { background:#fee2e2; border-color:#fecaca; color:#991b1b; }
      a { color:#3d8fd6; }
      .success-wrap { text-align:center; padding:18px 10px; }
      .join-closed { display:none; position:relative; overflow:hidden; text-align:center; padding:26px 20px; margin: 0 0 16px; border-radius:16px; background: linear-gradient(180deg, #ffffff, #f8fbff); border:1px solid rgba(61,143,214,0.25); box-shadow: 0 12px 34px rgba(39,64,96,0.10), 0 4px 14px rgba(39,64,96,0.06); color:#274060; animation: jcIn .25s ease; }
      .join-closed::before { content:''; position:absolute; inset:0; background: radial-gradient(800px 200px at 110% -10%, rgba(61,143,214,0.10), transparent 60%), radial-gradient(200px 800px at -10% 110%, rgba(39,64,96,0.08), transparent 60%); pointer-events:none; }
      .join-closed::after { content:''; position:absolute; inset:0 auto auto 0; height:3px; width:100%; background: linear-gradient(90deg, var(--accent-blue), #5aa9e6); opacity:.9; border-top-left-radius:16px; border-top-right-radius:16px; }
      .jc-head { display:flex; flex-direction: column; gap:10px; align-items:center; justify-content:center; margin-top:6px; }
      .jc-icon { position:relative; display:grid; place-items:center; width:60px; height:60px; border-radius:50%; background:linear-gradient(135deg, var(--accent-blue), var(--main-blue)); color:#fff; box-shadow:0 10px 22px rgba(61,143,214,0.25); animation: jcPop .35s ease; }
      .jc-icon::after { content:''; position:absolute; inset:-4px; border-radius:50%; border:2px solid rgba(255,255,255,0.35); }
      .jc-icon i { font-size:1.25rem; }
      .jc-title {
        font-family: fb;
        font-size:1.2rem;
        display: inline-flex;
        align-items: center;
        gap: 6px;
        padding: 6px 10px;
        border-radius: 999px;
        background: linear-gradient(180deg, rgba(61, 143, 214, 0.10), rgba(61, 143, 214, 0.06));
        border: 1px solid rgba(61, 143, 214, 0.28);
        color: #3d8fd6;
        box-shadow: 0 1px 0 rgba(255, 255, 255, 0.8) inset;
      }
      .jc-logo { display:grid; place-items:center; margin-bottom:1rem; }
      .jc-logo img { width:10rem;}
      .jc-desc { margin:12px 0 8px; color:#335c81; line-height:1.8; }
      .jc-next { display:none; margin:4px 0 16px; color:#274060; font-size:.95rem; }
      .jc-next small { color:#335c81; }
      .jc-actions { display:flex; align-items:center; justify-content:center; gap:12px; margin-top:4px; }
      .jc-actions .btn { min-width: 200px; }
      @keyframes jcIn { from { opacity:0; transform: translateY(-6px);} to { opacity:1; transform: translateY(0);} }
      @keyframes jcPop { from { transform: scale(.92);} to { transform: scale(1);} }
      @media (max-width:560px){ .jc-icon { width:52px; height:52px; } .jc-title { font-size:1.1rem; } .jc-actions .btn { min-width: 160px; } }
      @media (prefers-reduced-motion: reduce){ .join-closed, .jc-icon { animation:none !important; } }
      .field-error { display:none; align-items:center; gap:8px; margin: 20px 0px; padding:8px 10px; border-radius:10px; background: rgba(245,158,11,.08); border:1px solid rgba(245,158,11,.3); color:#92400e; max-height:0; opacity:0; overflow:hidden; transform: translateY(-4px); transition: max-height .25s ease, opacity .2s ease, transform .2s ease; }
      .field-error.show { display:flex; max-height: 120px; opacity: 1; transform: translateY(0); margin-top:6px; }
      .field-error i { color:#d97706; }
      .invalid { border-color:#f59e0b !important; box-shadow:0 0 0 3px rgba(245,158,11,.2); }
      /* Modern Adeeb field styling */
      input[type=text], input[type=tel], input[type=email], input[type=url], select, textarea {
        box-shadow: 0 1px 0 rgba(255,255,255,0.8) inset, 0 2px 10px rgba(39,64,96,0.06);
        transition: border-color .2s ease, box-shadow .2s ease, background-color .2s ease, transform .1s ease;
        background: linear-gradient(180deg, rgba(255,255,255,0.96), rgba(249,251,255,0.98));
        border-color: #e3eef9;
        margin-bottom: 2rem;
      }
      /* Remove bottom spacing when error is visible */
      label.has-error input[type=text],
      label.has-error input[type=tel],
      label.has-error input[type=email],
      label.has-error input[type=url],
      label.has-error select,
      label.has-error textarea { margin-bottom: 0 !important; }
      /* Also when element is marked invalid */
      input.invalid, select.invalid, textarea.invalid { margin-bottom: 0 !important; }
      input[type=text]::placeholder, input[type=tel]::placeholder, input[type=email]::placeholder, input[type=url]::placeholder, textarea::placeholder { color:#7c8aa3; }
      input[type=text]:hover, input[type=tel]:hover, input[type=email]:hover, input[type=url]:hover, select:hover, textarea:hover {
        background: linear-gradient(180deg, #ffffff, #f7fbff);
        border-color: rgba(61,143,214,0.28);
      }
      input[type=text]:focus-visible, input[type=tel]:focus-visible, input[type=email]:focus-visible, input[type=url]:focus-visible, select:focus-visible, textarea:focus-visible {
        outline: none;
        box-shadow: 0 0 0 4px rgba(61,143,214,0.18), 0 2px 10px rgba(39,64,96,0.06);
        border-color: rgba(61,143,214,0.35);
      }
      /* Valid state */
      input.valid, select.valid, textarea.valid { border-color:#10b981 !important; box-shadow:0 0 0 3px rgba(16,185,129,.2), 0 1px 0 rgba(255,255,255,0.8) inset; }
      .chips.valid { border-color:#10b981 !important; box-shadow:0 0 0 3px rgba(16,185,129,.2), 0 1px 0 rgba(255,255,255,0.8) inset; }
      /* Custom select arrow */
      select { appearance: none; -webkit-appearance:none; -moz-appearance:none; background-image: url("data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' width='18' height='18' viewBox='0 0 24 24' fill='none' stroke='%23274060' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'><polyline points='6 9 12 15 18 9'></polyline></svg>"); background-repeat:no-repeat; background-position: 12px center; padding-left:38px; }
      .chips { display:flex; flex-wrap:wrap; align-items:center; gap:6px; padding:8px 10px; min-height:46px; border:1px solid rgba(61,143,214,0.25); border-radius:12px; background: linear-gradient(180deg, rgba(255,255,255,0.96), rgba(249,251,255,0.98)); box-shadow: 0 1px 0 rgba(255,255,255,0.8) inset, 0 2px 10px rgba(39,64,96,0.06); }
      .chips:focus-within { box-shadow:0 0 0 4px rgba(61,143,214,0.18), 0 2px 10px rgba(39,64,96,0.06); border-color: rgba(61,143,214,0.35); }
      .chips.invalid { border-color:#f59e0b !important; box-shadow:0 0 0 3px rgba(245,158,11,.2); }
      .chip { display:inline-flex; align-items:center; gap:6px; padding:6px 10px; border-radius:999px; background:linear-gradient(180deg, rgba(61,143,214,0.10), rgba(61,143,214,0.06)); border:1px solid rgba(61,143,214,0.28); color:#274060; font-size:.9rem; animation: chip-in .16s ease; }
      .chip .remove { display:inline-grid; place-items:center; width:18px; height:18px; border-radius:50%; background:rgba(39,64,96,0.06); color:#274060; border:none; cursor:pointer; }
      .chip .remove:hover { background:rgba(39,64,96,0.12); }
      .chips input { flex:1 1 140px; min-width:120px; border:none; outline:none; background:transparent; padding:6px 8px; font-family: inherit; color:#274060; }
      .chips .add-btn { display:inline-flex; align-items:center; gap:6px; height:32px; padding:0 12px; border-radius:999px; border:1px solid rgba(61,143,214,0.35); background: linear-gradient(180deg, #ffffff, #f8fbff); color: var(--main-blue); cursor:pointer; box-shadow: 0 1px 0 rgba(255,255,255,0.8) inset, 0 2px 10px rgba(39,64,96,0.06); transition: transform .15s ease, box-shadow .2s ease, background-color .2s ease; }
      .chips .add-btn:hover { transform: translateY(-1px); box-shadow: 0 8px 18px rgba(61,143,214,0.18); }
      .chips .add-btn:active { transform: translateY(0); box-shadow:none; }
      .chips .add-btn:disabled { opacity:.6; cursor:not-allowed; transform:none; box-shadow: none; }
      @keyframes chip-in { from { transform: scale(.96); opacity: .0; } to { transform: scale(1); opacity: 1; } }
      .step-hint { margin:10px 0 0; text-align:center; color:#274060; opacity:.9; font-size:.98rem; }
      /* Committee Info Modal */
      .committee-info-btn { display:inline-flex; align-items:center; gap:6px; padding:6px 12px; border-radius:8px; background:linear-gradient(180deg, #ffffff, #f8fbff); border:1px solid rgba(61,143,214,0.35); color:var(--main-blue); font-size:.85rem; cursor:pointer; transition: transform .15s ease, box-shadow .2s ease; }
      .committee-info-btn:hover { transform:translateY(-1px); box-shadow:0 4px 12px rgba(61,143,214,0.15); }
      .committee-info-btn i { font-size:.9em; }
      .modal-overlay { display:none; position:fixed; inset:0; background:rgba(39,64,96,0.5); backdrop-filter:blur(4px); z-index:9999; animation:fadeIn .2s ease; }
      .modal-overlay.active { display:flex; align-items:center; justify-content:center; padding:20px; }
      @keyframes fadeIn { from { opacity:0; } to { opacity:1; } }
      .modal-content { background:#ffffff; border-radius:16px; max-width:680px; width:100%; max-height:85vh; overflow:hidden; box-shadow:0 20px 60px rgba(39,64,96,0.3), 0 0 0 1px rgba(61,143,214,0.1); animation:slideUp .3s ease; }
      @keyframes slideUp { from { transform:translateY(20px); opacity:0; } to { transform:translateY(0); opacity:1; } }
      .modal-header { padding:20px 24px; border-bottom:1px solid rgba(61,143,214,0.1); background:linear-gradient(180deg, #f8fbff, #ffffff); }
      .modal-header h2 { margin:0; color:#274060; font-size:1.3rem; font-family:fb; display:flex; align-items:center; gap:10px; }
      .modal-header h2 i { color:#3d8fd6; font-size:.9em; }
      .modal-body { padding:20px 24px; overflow-y:auto; max-height:calc(85vh - 140px); }
      .committee-item { margin-bottom:20px; padding:16px; border-radius:12px; background:linear-gradient(180deg, rgba(61,143,214,0.03), rgba(61,143,214,0.01)); border:1px solid rgba(61,143,214,0.15); transition:transform .2s ease, box-shadow .2s ease; }
      .committee-item:hover { transform:translateY(-2px); box-shadow:0 6px 20px rgba(61,143,214,0.12); }
      .committee-item h3 { margin:0 0 8px; color:#274060; font-size:1.1rem; font-family:fb; display:flex; align-items:center; gap:8px; }
      .committee-item h3 i { color:#3d8fd6; font-size:.85em; }
      .committee-item p { margin:0; color:#335c81; line-height:1.6; }
      .committee-item ol { margin:8px 0 0; padding-right:20px; color:#335c81; }
      .committee-item ol li { margin:4px 0; }
      .modal-footer { padding:16px 24px; border-top:1px solid rgba(61,143,214,0.1); background:linear-gradient(180deg, #ffffff, #f8fbff); display:flex; justify-content:center; }
      .modal-close-btn { padding:10px 24px; border-radius:10px; background:linear-gradient(135deg, var(--accent-blue), var(--main-blue)); color:#fff; border:none; font-family:fb; font-size:.95rem; cursor:pointer; transition:transform .15s ease, box-shadow .2s ease; }
      .modal-close-btn:hover { transform:translateY(-1px); box-shadow:0 8px 18px rgba(61,143,214,0.25); }
      .modal-close-btn:active { transform:translateY(0); }
      /* Membership closing countdown (Hero card above form) */
      .mc-wrap { display:none; width:min(760px, 96vw); margin: 0px auto 1rem; padding: 16px; border-radius: 16px; background: linear-gradient(135deg, var(--accent-blue, #3d8fd6), var(--main-blue, #274060)); color:#fff; border: 1px solid rgba(255,255,255,0.18); box-shadow: 0 16px 40px rgba(2,6,23,.18), 0 0 0 1px rgba(61,143,214,.10); }
      .mc-head { display:flex; align-items:center; justify-content:center; gap: 10px; color:#fff; font-family: fb; font-size:1.05rem; }
      .mc-head i { opacity:.9; }
      .mc-timer { display:flex; gap:12px; align-items:center; justify-content:center; flex-wrap:wrap; margin-top:10px; }
      .mc-box { min-width:86px; display:grid; gap:6px; justify-items:center; background: rgba(255,255,255,0.14); border:1px solid rgba(255,255,255,0.28); padding:10px 12px; border-radius:12px; color:#fff; box-shadow: 0 1px 0 rgba(255,255,255,0.25) inset; }
      .mc-box span { font-family: fb; font-size: clamp(1.1rem, 3.5vw, 1.6rem); letter-spacing:.5px; }
      .mc-box small { font-family: fr; opacity:.9; }
      @media (max-width:560px){ .mc-box { min-width:70px; padding:8px 10px; } }
      /* Invitation expiry countdown */
      .inv-countdown { display:none; width:min(760px, 96vw); margin: 0px auto 1rem; padding: 14px 16px; border-radius: 12px; background: linear-gradient(135deg, #f59e0b, #d97706); color:#fff; border: 1px solid rgba(255,255,255,0.2); box-shadow: 0 12px 30px rgba(245,158,11,.2); }
      .inv-countdown-head { display:flex; align-items:center; justify-content:center; gap: 8px; color:#fff; font-family: fb; font-size:1rem; }
      .inv-countdown-head i { opacity:.95; }
      .inv-countdown-timer { display:flex; gap:10px; align-items:center; justify-content:center; flex-wrap:wrap; margin-top:8px; }
      .inv-countdown-box { min-width:75px; display:grid; gap:4px; justify-items:center; background: rgba(255,255,255,0.16); border:1px solid rgba(255,255,255,0.3); padding:8px 10px; border-radius:10px; color:#fff; box-shadow: 0 1px 0 rgba(255,255,255,0.3) inset; }
      .inv-countdown-box span { font-family: fb; font-size: clamp(1rem, 3vw, 1.4rem); letter-spacing:.3px; }
      .inv-countdown-box small { font-family: fr; opacity:.95; font-size:.85rem; }
      @media (max-width:560px){ .inv-countdown-box { min-width:65px; padding:6px 8px; } }
    </style>
  </head>
  <body>
    <!-- Invitation expiry countdown (shown when using invitation link) -->
    <div id="invitationCountdown" class="inv-countdown" aria-live="polite">
      <div class="inv-countdown-head">
        <div class="inv-countdown-label"><i class="fa-solid fa-clock"></i> ØªÙ†ØªÙ‡ÙŠ ØµÙ„Ø§Ø­ÙŠØ© Ø±Ø§Ø¨Ø· Ø§Ù„Ø¯Ø¹ÙˆØ© Ø¨Ø¹Ø¯</div>
      </div>
      <div class="inv-countdown-timer">
        <div class="inv-countdown-box"><span id="invDays">--</span><small>ÙŠÙˆÙ…</small></div>
        <div class="inv-countdown-box"><span id="invHours">--</span><small>Ø³Ø§Ø¹Ø©</small></div>
        <div class="inv-countdown-box"><span id="invMinutes">--</span><small>Ø¯Ù‚ÙŠÙ‚Ø©</small></div>
        <div class="inv-countdown-box"><span id="invSeconds">--</span><small>Ø«Ø§Ù†ÙŠØ©</small></div>
      </div>
    </div>

    <!-- Membership closing countdown -->
    <div id="membershipCountdown" class="mc-wrap" aria-live="polite">
      <div class="mc-head">
        <div class="mc-label"><i class="fa-regular fa-hourglass-half"></i> ÙŠØºÙ„Ù‚ Ø§Ù„ØªØ³Ø¬ÙŠÙ„ Ø¨Ø¹Ø¯</div>
      </div>
      <div class="mc-timer">
        <div class="mc-box"><span id="mcDays">--</span><small>ÙŠÙˆÙ…</small></div>
        <div class="mc-box"><span id="mcHours">--</span><small>Ø³Ø§Ø¹Ø©</small></div>
        <div class="mc-box"><span id="mcMinutes">--</span><small>Ø¯Ù‚ÙŠÙ‚Ø©</small></div>
        <div class="mc-box"><span id="mcSeconds">--</span><small>Ø«Ø§Ù†ÙŠØ©</small></div>
      </div>
    </div>
    <div class="card" role="main">
      <header>
        <img alt="Ø´Ø¹Ø§Ø± Ù†Ø§Ø¯ÙŠ Ø£Ø¯ÙŠØ¨" src="https://lh3.googleusercontent.com/d/195w-tUBF_VKwFOm3Sh06fmwnlYzIyw0e" />
        <div>
          <h1>ØªØ³Ø¬ÙŠÙ„ Ø¹Ø¶ÙˆÙŠØ©</h1>
        </div>
      </header>
      <div class="steps" id="stepsBar" aria-hidden="false">
        <div class="step active" data-step="0"><div class="dot">1</div><div class="label">Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ©</div></div>
        <div class="sep"></div>
        <div class="step" data-step="1"><div class="dot">2</div><div class="label">Ø§Ù„ØªÙˆØ§ØµÙ„ ÙˆØ§Ù„Ø¬Ø§Ù…Ø¹Ø©</div></div>
        <div class="sep"></div>
        <div class="step" data-step="2"><div class="dot">3</div><div class="label">Ù…Ù‡Ø§Ø±Ø§ØªÙƒ ÙˆØ§Ù‡ØªÙ…Ø§Ù…Ø§ØªÙƒ</div></div>
        <div class="sep"></div>
        <div class="step" data-step="3"><div class="dot">4</div><div class="label">Ø§Ù„Ø³ÙˆØ´ÙŠØ§Ù„ ÙˆÙ†Ø¨Ø°Ø©</div></div>
      </div>
      <p id="stepHint" class="step-hint">Ø§Ù„Ù…Ø­Ø·Ø© Ø§Ù„Ø£ÙˆÙ„Ù‰: Ø¹Ø±ÙÙ†Ø§ Ø¹Ù† Ø£Ø³Ù…Ùƒ ÙŠØ§ Ù†Ø¹Ù… Ø§Ù„Ù…Ø¹Ø±ÙØ©</p>
      <div id="joinClosedCard" class="join-closed" role="status" aria-live="polite">
        <div class="jc-logo"><img alt="Ø´Ø¹Ø§Ø± Ù†Ø§Ø¯ÙŠ Ø£Ø¯ÙŠØ¨" src="https://lh3.googleusercontent.com/d/195w-tUBF_VKwFOm3Sh06fmwnlYzIyw0e" /></div>
        <div class="jc-head">
          <div class="jc-icon"><i class="fa-solid fa-lock"></i></div>
          <div class="jc-title">ØªÙ… Ø¥ØºÙ„Ø§Ù‚ Ø¨Ø§Ø¨ Ø§Ù„ØªØ³Ø¬ÙŠÙ„</div>
        </div>
        <div class="jc-desc">Ù†Ø¹ØªØ°Ø±ØŒ Ø¨Ø§Ø¨ Ø§Ù„ØªØ³Ø¬ÙŠÙ„ Ù…ØºÙ„Ù‚ Ø­Ø§Ù„ÙŠÙ‹Ø§. ØªØ§Ø¨Ø¹Ù†Ø§ Ù„Ù…Ø¹Ø±ÙØ© Ù…ÙˆØ¹Ø¯ Ø§Ù„ÙØªØ­ Ø§Ù„Ù‚Ø§Ø¯Ù….</div>
        <div id="jcNext" class="jc-next" aria-live="polite"></div>
        <div class="jc-actions">
          <a class="btn btn-primary" href="index.html"><i class="fa-solid fa-arrow-right"></i><span>Ø§Ù„Ø±Ø¬ÙˆØ¹ Ù„Ù…ÙˆÙ‚Ø¹ Ø£Ø¯ÙÙŠØ¨</span></a>
        </div>
      </div>

      <div id="status" class="alert" aria-live="polite"></div>

      <form id="membershipForm" novalidate>
        <section class="step-pane active" data-step="0">
          <div class="grid">
            <label>
              Ø§Ù„Ø£Ø³Ù… Ø§Ù„Ø«Ù„Ø§Ø«ÙŠâœğŸ»
              <input id="fullName" name="fullName" type="text" required placeholder="Ø£ÙƒØªØ¨ Ø§Ù„Ø£Ø³Ù… Ù‡ÙÙ†Ø§" />
              <div id="fullNameError" class="field-error" role="alert" aria-live="polite"><i class="fa-solid fa-triangle-exclamation"></i><div><strong>Ø£Ø¯Ø®Ù„ Ø£Ø³Ù…Ùƒ Ø§Ù„Ø«Ù„Ø§Ø«ÙŠ</strong><div class="muted">Ø§Ù„Ø§Ø³Ù… Ø§Ù„Ø£ÙˆÙ„ØŒ Ø§Ø³Ù… Ø§Ù„Ø£Ø¨ØŒ Ø§Ø³Ù… Ø§Ù„Ø¹Ø§Ø¦Ù„Ø©</div></div></div>
            </label>
          </div>
        </section>

        <section class="step-pane" data-step="1">
          <div class="grid">
            <label>
              Ø±Ù‚Ù… Ø§Ù„Ø¬ÙˆØ§Ù„ğŸ“±
              <input id="phone" name="phone" type="tel" required placeholder="05XXXXXXXX" inputmode="numeric" autocomplete="tel" pattern="^05[0-9]{8}$" maxlength="10" />
              <div id="phoneError" class="field-error" role="alert" aria-live="polite"><i class="fa-solid fa-triangle-exclamation"></i><div><strong>Ø£Ø¯Ø®Ù„ Ø±Ù‚Ù… Ø¬ÙˆØ§Ù„ ØµØ­ÙŠØ­</strong><div class="muted">10 Ø£Ø±Ù‚Ø§Ù… ØªØ¨Ø¯Ø£ Ø¨Ù€ 05 (Ù…Ø«Ø§Ù„: 05XXXXXXXX)</div></div></div>
            </label>
          </div>
          <div class="grid">
            <label>
              Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠğŸ“§
              <input id="email" name="email" type="email" required placeholder="name@example.com" />
              <div id="emailError" class="field-error" role="alert" aria-live="polite"><i class="fa-solid fa-triangle-exclamation"></i><div><strong>Ø£Ø¯Ø®Ù„ Ø¨Ø±ÙŠØ¯Ù‹Ø§ Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠÙ‹Ø§ ØµØ§Ù„Ø­Ù‹Ø§</strong><div class="muted">Ù…Ø«Ø§Ù„: name@example.com</div></div></div>
            </label>
          </div>
          <div class="grid">
            <label>
              Ø§Ù„Ø¯Ø±Ø¬Ø© Ø§Ù„Ø¹Ù„Ù…ÙŠØ©ğŸ“
              <select id="degree" name="degree" required>
                <option value="">Ø§Ø®ØªØ± Ø§Ù„Ø¯Ø±Ø¬Ø© Ø§Ù„Ø¹Ù„Ù…ÙŠØ©</option>
                <option>Ø«Ø§Ù†ÙˆÙŠ</option>
                <option>Ù…ÙˆØ¸Ù</option>
                <option>Ø¯Ø¨Ù„ÙˆÙ…</option>
                <option>Ø¨ÙƒØ§Ù„ÙˆØ±ÙŠÙˆØ³</option>
                <option>Ù…Ø§Ø¬Ø³ØªÙŠØ±</option>
                <option>Ø¯ÙƒØªÙˆØ±Ø§Ù‡</option>
              </select>
            </label>
          </div>
          <div class="grid two" id="collegeMajorRow">
            <label>
              Ø§Ù„ÙƒÙ„ÙŠØ©ğŸ«
              <input id="college" name="college" type="text" placeholder="Ø£Ø³Ù… Ø§Ù„ÙƒÙ„ÙŠØ©" required />
            </label>
            <label>
              Ø§Ù„ØªØ®ØµØµğŸ“š
              <input id="major" name="major" type="text" placeholder="Ø£Ø³Ù… Ø§Ù„ØªØ®ØµØµ" required />
            </label>
          </div>
        </section>

        <section class="step-pane" data-step="2">
          <div class="grid">
            <label id="skillsLabel">
              Ø§Ù„Ù…Ù‡Ø§Ø±Ø§ØªğŸ”‘
              <input id="skills" name="skills" type="hidden" required />
              <div id="skillsChips" class="chips" role="group" aria-labelledby="skillsLabel">
                <input id="skillsInputUI" type="text" placeholder="Ù…Ø«Ø§Ù„: ÙƒØªØ§Ø¨Ø©ØŒ ØªØµÙˆÙŠØ±ØŒ ØªØµÙ…ÙŠÙ…ØŒ Ø¨Ø±Ù…Ø¬Ø©" />
                <button type="button" id="addSkillBtn" class="add-btn" aria-label="Ø¥Ø¶Ø§ÙØ© Ù…Ù‡Ø§Ø±Ø©"><i class="fa-solid fa-plus"></i><span>Ø¥Ø¶Ø§ÙØ©</span></button>
              </div>
            </label>
            <label>
              Ø§Ù„Ù„Ø¬Ù†Ø© Ø§Ù„Ù…Ø±ØºÙˆØ¨ Ø¨Ù‡Ø§ğŸ‘¤
              <button type="button" class="committee-info-btn" id="committeeInfoBtn">
                <i class="fa-solid fa-info-circle"></i>
                <span>Ø§Ø¶ØºØ· Ù„Ù„ØªØ¹Ø±Ù Ø¹Ù„Ù‰ Ù„Ø¬Ø§Ù† Ø£Ø¯ÙÙŠØ¨</span>
              </button>
              <select id="preferredCommittee" name="preferredCommittee" required>
                <option value="">Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù„Ø¬Ø§Ù†...</option>
              </select>
            </label>
            <label>
              Ø´Ø§Ø±ÙƒÙ†Ø§ Ø±Ø§Ø¨Ø· Ù…Ù† Ø£Ø¹Ù…Ø§Ù„Ùƒ Ø¥Ù†Ù‘ ÙˆØ¬Ø¯ğŸ”—
              <input id="portfolioUrl" name="portfolioUrl" type="url" placeholder="https://example.com/portfolio" />
            </label>
          </div>
        </section>

        <section class="step-pane" data-step="3">
          <div class="grid">
            <label>
              ØªÙˆÙŠØªØ±ğŸ”—
              <input id="twitter" name="twitter" type="url" placeholder="https://twitter.com/username" />
            </label>
            <label>
              Ø¥Ù†Ø³ØªØºØ±Ø§Ù…ğŸ”—
              <input id="instagram" name="instagram" type="url" placeholder="https://instagram.com/username" />
            </label>
            <label>
              ØªÙŠÙƒ ØªÙˆÙƒğŸ”—
              <input id="linkedin" name="linkedin" type="url" placeholder="https://www.tiktok.com/in/username" />
            </label>
          </div>
          <div class="grid" style="margin-top:12px">
            <label>
              Ø­Ø¯Ù‘Ø«Ù†Ø§ Ø¹Ù† Ù†ÙØ³Ùƒ ÙˆØ·Ù…ÙˆØ­Ø§ØªÙƒ Ø§Ù„ØªÙŠ ØªØ±ÙŠØ¯ ØªØ­Ù‚ÙŠÙ‚Ù‡Ø§ Ù…Ø¹ Ø£Ø¯ÙÙŠØ¨ğŸª¶
              <textarea id="about" name="about" required placeholder="Ù‡Ø°Ù‡ Ù…Ø³Ø§Ø­ØªÙƒ Ø§Ù„Ø­ÙØ±Ù‘Ù‡ØŒ ÙƒÙÙ„Ù‡Ø§ Ù„Ùƒ"></textarea>
            </label>
          </div>
        </section>

        <div class="actions">
          <div class="left">
            <button type="button" class="btn btn-outline" id="prevBtn"><i class="fa-solid fa-arrow-right"></i> Ø§Ù„Ø³Ø§Ø¨Ù‚</button>
            <button type="button" class="btn btn-primary" id="nextBtn">Ø§Ù„ØªØ§Ù„ÙŠ <i class="fa-solid fa-arrow-left"></i></button>
          </div>
          <button type="submit" class="btn btn-primary" id="submitBtn" style="display:none"><i class="fa-solid fa-paper-plane"></i> Ø¥ÙƒÙ…Ø§Ù„ Ø·Ù„Ø¨ Ø§Ù„ØªØ³Ø¬ÙŠÙ„</button>
        </div>
      </form>
    </div>

    <!-- Committee Info Modal -->
    <div class="modal-overlay" id="committeeModal">
      <div class="modal-content">
        <div class="modal-header">
          <h2><i class="fa-solid fa-users"></i> Ù„Ø¬Ø§Ù† Ù†Ø§Ø¯ÙŠ Ø£Ø¯ÙÙŠØ¨</h2>
        </div>
        <div class="modal-body" id="committeeModalBody">
          <div style="text-align: center; padding: 20px; color: #64748b;">
            <i class="fa-solid fa-spinner fa-spin" style="font-size: 2rem;"></i>
            <p style="margin-top: 10px;">Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ù„Ø¬Ø§Ù†...</p>
          </div>
        </div>
        <div class="modal-footer">
          <button type="button" class="modal-close-btn" id="closeModalBtn">Ø¥ØºÙ„Ø§Ù‚</button>
        </div>
      </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="supabase-config.js"></script>
    <script src="visit-tracker.js"></script>
    <script>
      function adeebUuid(){ try { return crypto.randomUUID(); } catch { return 'v-' + Math.random().toString(36).slice(2) + Date.now().toString(36); } }
      function getVisitorId(){ try { const k='adeeb_visitor_id'; let id=localStorage.getItem(k); if(!id){ id=adeebUuid(); localStorage.setItem(k,id); localStorage.setItem('adeeb_first_seen', new Date().toISOString()); } return id; } catch { return adeebUuid(); } }
      function getSessionId(){ try { const k='adeeb_session_id'; let sid=sessionStorage.getItem(k); if(!sid){ sid=adeebUuid(); sessionStorage.setItem(k,sid); } return sid; } catch { return adeebUuid(); } }

      (function(){
        const form = document.getElementById('membershipForm');
        const panes = Array.from(document.querySelectorAll('.step-pane'));
        const steps = Array.from(document.querySelectorAll('.steps .step'));
        const stepHint = document.getElementById('stepHint');
        const stepsBarEl = document.getElementById('stepsBar');
        const joinClosedCard = document.getElementById('joinClosedCard');
        const pageCard = document.querySelector('.card[role="main"]');
        const headerEl = pageCard ? pageCard.querySelector('header') : document.querySelector('.card > header');
        const jcNext = document.getElementById('jcNext');
        const status = document.getElementById('status');
        const prevBtn = document.getElementById('prevBtn');
        const nextBtn = document.getElementById('nextBtn');
        const submitBtn = document.getElementById('submitBtn');
        const fullNameInput = document.getElementById('fullName');
        const phoneInput = document.getElementById('phone');
        const emailInput = document.getElementById('email');
        const fullNameError = document.getElementById('fullNameError');
        const phoneError = document.getElementById('phoneError');
        const emailError = document.getElementById('emailError');
        const degreeInput = document.getElementById('degree');
        const collegeMajorRow = document.getElementById('collegeMajorRow');
        const collegeInput = document.getElementById('college');
        const majorInput = document.getElementById('major');
        const skillsInput = document.getElementById('skills');
        const preferredCommitteeInput = document.getElementById('preferredCommittee');
        const skillsChips = document.getElementById('skillsChips');
        const skillsUI = document.getElementById('skillsInputUI');
        const addSkillBtn = document.getElementById('addSkillBtn');
        let skillsTags = [];
        let cur = 0;
        const touched = new Set();
        let skillsTouched = false;

        // Membership closing countdown
        const mcWrap = document.getElementById('membershipCountdown');
        const mcDays = document.getElementById('mcDays');
        const mcHours = document.getElementById('mcHours');
        const mcMinutes = document.getElementById('mcMinutes');
        const mcSeconds = document.getElementById('mcSeconds');
        let mcInterval = null;
        function publicSettingsGet(){ try { const raw=localStorage.getItem('adeeb_settings'); const obj= raw? JSON.parse(raw): {}; return (obj && typeof obj==='object' && !Array.isArray(obj))? obj : {}; } catch { return {}; } }
        function publicSettingsSet(obj){ try { localStorage.setItem('adeeb_settings', JSON.stringify(obj||{})); } catch {} }
        function isJoinOpenEffective(s){
          try {
            const sched = !!s.join_schedule_enabled;
            const openIso = s.join_schedule_open_at || null;
            const closeIso = s.join_schedule_close_at || null;
            if (sched && (openIso || closeIso)) {
              const now = Date.now();
              const openTs = openIso ? Date.parse(openIso) : null;
              const closeTs = closeIso ? Date.parse(closeIso) : null;
              if (openTs && closeTs) return now >= openTs && now < closeTs;
              if (openTs && !closeTs) return now >= openTs;
              if (!openTs && closeTs) return now < closeTs;
            }
            return s.join_open !== false;
          } catch { return s && s.join_open !== false; }
        }
        async function syncSettingsFromRemote(){
          const sb = window.sbClient;
          if(!sb) return;
          try {
            const { data, error } = await sb
              .from('membership_settings')
              .select('id, join_open, join_membership_countdown, join_schedule_enabled, join_schedule_mode, join_schedule_open_at, join_schedule_close_at, updated_at')
              .eq('id','default')
              .maybeSingle();
            if(error) throw error;
            if(data && typeof data==='object'){
              const cur = publicSettingsGet();
              publicSettingsSet({
                ...cur,
                join_open: data.join_open !== false,
                join_membership_countdown: !!data.join_membership_countdown,
                join_schedule_enabled: !!data.join_schedule_enabled,
                join_schedule_mode: data.join_schedule_mode || cur.join_schedule_mode,
                join_schedule_open_at: data.join_schedule_open_at || cur.join_schedule_open_at,
                join_schedule_close_at: data.join_schedule_close_at || cur.join_schedule_close_at,
              });
            }
          } catch{}
        }
        function computeCloseTarget(s){
          try{
            if(!s.join_schedule_enabled) return null;
            const mode = s.join_schedule_mode || 'range';
            const closeIso = s.join_schedule_close_at || null;
            if(!closeIso) return null;
            const closeTs = Date.parse(closeIso);
            if(Number.isNaN(closeTs)) return null;
            const now = Date.now();
            // Show countdown only while registration is effectively open and close is in the future
            if(!isJoinOpenEffective(s)) return null;
            if(now >= closeTs) return null;
            if(mode === 'range' || mode === 'close_only') return closeTs;
            return null;
          } catch { return null; }
        }
        function hasJoinConfig(s){ try { return !!(s && ('join_open' in s || 'join_schedule_enabled' in s || 'join_schedule_open_at' in s || 'join_schedule_close_at' in s)); } catch { return false; } }
        function enforceJoinAccess(){
          try{
            const s = publicSettingsGet();
            // Ø¥Ø°Ø§ ÙƒØ§Ù† Ù‡Ù†Ø§Ùƒ Ø¯Ø¹ÙˆØ© ØµØ§Ù„Ø­Ø©ØŒ ØªØ¬Ø§Ù‡Ù„ Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„ØªØ³Ø¬ÙŠÙ„
            const hasValidInvitation = !!invitationData;
            const isOpen = hasValidInvitation || isJoinOpenEffective(s);
            if (joinClosedCard) joinClosedCard.style.display = isOpen ? 'none' : 'block';
            if (pageCard) pageCard.classList.toggle('closed-state', !isOpen);
            if (headerEl) headerEl.style.display = isOpen ? '' : 'none';
            if (stepsBarEl) stepsBarEl.style.display = isOpen ? '' : 'none';
            if (stepHint) stepHint.style.display = isOpen ? '' : 'none';
            if (form) form.style.display = isOpen ? '' : 'none';
            if (!isOpen) {
              if (jcNext) {
                let msg = '';
                try {
                  if (s && s.join_schedule_enabled) {
                    const now = Date.now();
                    const o = s.join_schedule_open_at ? Date.parse(s.join_schedule_open_at) : NaN;
                    const c = s.join_schedule_close_at ? Date.parse(s.join_schedule_close_at) : NaN;
                    const opts = { dateStyle: 'long', timeStyle: 'short' };
                    if (!Number.isNaN(o) && now < o) {
                      msg = `Ø³ÙŠÙÙØªØ­ Ø§Ù„ØªØ³Ø¬ÙŠÙ„ ${new Date(o).toLocaleString('ar', opts)}`;
                    } else if (!Number.isNaN(c)) {
                      msg = `Ø£ÙØºÙ„Ù‚ Ø§Ù„ØªØ³Ø¬ÙŠÙ„ ${new Date(c).toLocaleString('ar', opts)}`;
                    }
                  }
                } catch {}
                jcNext.textContent = msg;
                jcNext.style.display = msg ? 'block' : 'none';
              }
            } else {
              if (jcNext) jcNext.style.display = 'none';
            }
            const btns = [prevBtn, nextBtn, submitBtn];
            btns.forEach(b => { if(!b) return; if(isOpen){ b.disabled=false; b.removeAttribute('aria-disabled'); } else { b.disabled=true; b.setAttribute('aria-disabled','true'); } });
          } catch {}
        }
        function startMembershipCountdown(){
          const s = publicSettingsGet();
          const show = !!s.join_membership_countdown;
          const target = computeCloseTarget(s);
          if(!mcWrap) return;
          if(!show || !target){
            mcWrap.style.display = 'none';
            if(mcInterval){ try{ clearInterval(mcInterval); }catch{} mcInterval=null; }
            return;
          }
          mcWrap.style.display = 'block';
          function tick(){
            const now = Date.now();
            let diff = Math.max(0, Math.floor((target - now)/1000));
            if(diff <= 0){ mcWrap.style.display='none'; if(mcInterval){ clearInterval(mcInterval); mcInterval=null; } return; }
            const d = Math.floor(diff / 86400); diff -= d*86400;
            const h = Math.floor(diff / 3600); diff -= h*3600;
            const m = Math.floor(diff / 60); diff -= m*60;
            const s2= diff;
            if(mcDays) mcDays.textContent = String(d).padStart(2,'0');
            if(mcHours) mcHours.textContent = String(h).padStart(2,'0');
            if(mcMinutes) mcMinutes.textContent = String(m).padStart(2,'0');
            if(mcSeconds) mcSeconds.textContent = String(s2).padStart(2,'0');
          }
          if(mcInterval){ clearInterval(mcInterval); mcInterval=null; }
          tick();
          mcInterval = setInterval(tick, 1000);
        }
        // Init: sync remote (if available), then start countdown, and refresh periodically
        enforceJoinAccess();
        syncSettingsFromRemote().then(()=>{ enforceJoinAccess(); startMembershipCountdown(); }).catch(()=>{ enforceJoinAccess(); startMembershipCountdown(); });
        setInterval(()=>{ try { startMembershipCountdown(); } catch {} }, 60000);

        // Realtime: apply changes instantly when admin updates settings
        let mcRtChannel = null;
        function ensureMembershipRealtime(){
          try{
            const sb = window.sbClient;
            if(!sb || mcRtChannel) return;
            mcRtChannel = sb.channel('public:membership_settings');
            mcRtChannel
              .on('postgres_changes', { event: '*', schema: 'public', table: 'membership_settings', filter: 'id=eq.default' }, (payload)=>{
                try{
                  const data = (payload && (payload.new || payload.old)) || {};
                  const cur = publicSettingsGet();
                  publicSettingsSet({
                    ...cur,
                    join_open: data.join_open !== false,
                    join_membership_countdown: typeof data.join_membership_countdown === 'boolean' ? data.join_membership_countdown : cur.join_membership_countdown,
                    join_control_type: data.join_control_type || cur.join_control_type,
                    join_schedule_enabled: !!data.join_schedule_enabled,
                    join_schedule_mode: data.join_schedule_mode || cur.join_schedule_mode,
                    join_schedule_open_at: data.join_schedule_open_at || cur.join_schedule_open_at,
                    join_schedule_close_at: data.join_schedule_close_at || cur.join_schedule_close_at,
                  });
                  enforceJoinAccess(); startMembershipCountdown();
                } catch{}
              })
              .subscribe();
          } catch{}
        }
        ensureMembershipRealtime();

        function ensureErrorEl(el){
          if(!el) return null;
          if(el.id === 'fullName') return fullNameError;
          if(el.id === 'phone') return phoneError;
          if(el.id === 'email') return emailError;
          const label = el.closest('label');
          if(!label) return null;
          let err = label.querySelector('.field-error[data-auto="1"]');
          if(!err){
            err = document.createElement('div');
            err.className = 'field-error';
            err.setAttribute('role','alert');
            err.setAttribute('aria-live','polite');
            err.setAttribute('data-auto','1');
            err.innerHTML = '<i class="fa-solid fa-triangle-exclamation"></i><div><strong></strong><div class="muted"></div></div>';
            label.appendChild(err);
          }
          return err;
        }
        function showErr(el, title, sub){
          const err = ensureErrorEl(el);
          if(err){
            const t = err.querySelector('strong'); if(t) t.textContent = title || 'Ù‡Ø°Ø§ Ø§Ù„Ø­Ù‚Ù„ Ù…Ø·Ù„ÙˆØ¨';
            const s = err.querySelector('.muted'); if(s) s.textContent = sub || 'Ø±Ø¬Ø§Ø¡Ù‹ Ø§Ù…Ù„Ø£ Ù‡Ø°Ø§ Ø§Ù„Ø­Ù‚Ù„';
            err.classList.add('show');
          }
          el?.classList.add('invalid');
          el?.setAttribute('aria-invalid','true');
          el?.classList.remove('valid');
          if(el === skillsInput && skillsChips) skillsChips.classList.add('invalid');
          if(el === skillsInput && skillsChips) skillsChips.classList.remove('valid');
          const lbl = el?.closest('label');
          if(lbl) lbl.classList.add('has-error');
        }
        function hideErr(el){
          const err = ensureErrorEl(el);
          if(err) err.classList.remove('show');
          el?.classList.remove('invalid');
          el?.removeAttribute('aria-invalid');
          if(el === skillsInput && skillsChips) skillsChips.classList.remove('invalid');
          const lbl = el?.closest('label');
          if(lbl) lbl.classList.remove('has-error');
        }

        function getDisplayName(){ const v = (fullNameInput && fullNameInput.value ? fullNameInput.value.trim() : ''); return v ? v.split(/\s+/)[0] : ''; }
        function updateStepHint(){
          if(!stepHint) return;
          const name = getDisplayName();
          let msg = '';
          if(cur === 0){ msg = 'Ø¹Ø±ÙÙ†Ø§ Ø¹Ù„Ù‰ Ø£Ø³Ù…Ùƒ ÙŠØ§ Ù†Ø¹Ù…Ù‘ Ø§Ù„Ù…Ø¹Ø±ÙØ©ğŸ¤ğŸ»'; }
          else if(cur === 1){ msg = name ? `Ø£Ù‡Ù„Ø§Ù‹ Ø£Ù‡Ù„Ø§Ù‹ ${name}, ÙƒÙŠÙ Ù…ÙÙ…ÙƒÙ† Ù†ØªÙˆØ§ØµÙ„ Ù…Ø¹ÙƒğŸ¤”` : 'Ø£Ù‡Ù„Ø§Ù‹ Ø£Ù‡Ù„Ø§Ù‹! Ø¹Ø±ÙÙ†Ø§ ÙƒÙŠÙ Ù†ØªÙˆØ§ØµÙ„ Ù…Ø¹ÙƒØŸ'; }
          else if(cur === 2){ msg = name ? `Ù…ØªØ­Ù…Ø³ÙŠÙ† Ù†ØªØ¹Ø±Ù Ø¹Ù„Ù‰ Ù…Ù‡Ø§Ø±Ø§ØªÙƒ ÙŠØ§ ${name} ğŸ¤©` : 'Ù…ØªØ­Ù…Ø³ÙŠÙ† Ù†Ø¹Ø±Ù Ù…Ù‡Ø§Ø±Ø§ØªÙƒ'; }
          else { msg = name ? `Ø®ÙØªØ§Ù…Ù‹Ø§ØŒ Ù‡Ø°Ù‡ Ù…Ø³Ø§Ø­ØªÙƒ ÙŠØ§ ${name} ğŸª¶` : 'Ø®ÙØªØ§Ù…Ù‹Ø§ØŒ Ù‡Ø°Ù‡ Ù…Ø³Ø§Ø­ØªÙƒ ğŸª¶'; }
          stepHint.textContent = msg;
        }

        function showStep(i){
          cur = Math.max(0, Math.min(panes.length-1, i));
          panes.forEach((p,idx)=>{ p.classList.toggle('active', idx===cur); });
          steps.forEach((s,idx)=>{ s.classList.toggle('active', idx===cur); s.classList.toggle('done', idx<cur); });
          prevBtn.style.display = cur===0 ? 'none' : '';
          nextBtn.style.display = cur===panes.length-1 ? 'none' : '';
          submitBtn.style.display = cur===panes.length-1 ? '' : 'none';
          updateStepHint();
        }
        function validateStep(){
          const pane = panes[cur];
          let firstInvalid = null;
          const required = Array.from(pane.querySelectorAll('[required]'));
          for(const el of required){
            if(el === fullNameInput){
              const parts = (fullNameInput.value||'').trim().split(/\s+/).filter(Boolean);
              if(parts.length < 3){
                showErr(fullNameInput, 'Ø£Ø¯Ø®Ù„ Ø§Ø³Ù…Ùƒ Ø§Ù„Ø«Ù„Ø§Ø«ÙŠ', 'Ø§Ù„Ø§Ø³Ù… Ø§Ù„Ø£ÙˆÙ„ØŒ Ø§Ø³Ù… Ø§Ù„Ø£Ø¨ØŒ Ø§Ø³Ù… Ø§Ù„Ø¹Ø§Ø¦Ù„Ø©');
                if(!firstInvalid) firstInvalid = fullNameInput;
              } else { hideErr(fullNameInput); }
              fullNameInput.classList.toggle('valid', parts.length >= 3);
              continue;
            }
            if(cur === 1 && el === phoneInput){
              const raw = (phoneInput.value||'').trim();
              const digits = raw.replace(/\D/g,'');
              const ok = /^05\d{8}$/.test(digits);
              if(!ok){ showErr(phoneInput, 'Ø£Ø¯Ø®Ù„ Ø±Ù‚Ù… Ø¬ÙˆØ§Ù„ ØµØ­ÙŠØ­', '10 Ø£Ø±Ù‚Ø§Ù… ØªØ¨Ø¯Ø£ Ø¨Ù€ 05 (Ù…Ø«Ø§Ù„: 05XXXXXXXX)'); if(!firstInvalid) firstInvalid = phoneInput; } else { hideErr(phoneInput); }
              phoneInput.classList.toggle('valid', ok);
              continue;
            }
            if(cur === 1 && el === emailInput){
              const val = (emailInput.value||'').trim();
              const ok = /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(val);
              if(!ok){ showErr(emailInput, 'Ø£Ø¯Ø®Ù„ Ø¨Ø±ÙŠØ¯Ù‹Ø§ Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠÙ‹Ø§ ØµØ§Ù„Ø­Ù‹Ø§', 'Ù…Ø«Ø§Ù„: name@example.com'); if(!firstInvalid) firstInvalid = emailInput; } else { hideErr(emailInput); }
              emailInput.classList.toggle('valid', ok);
              continue;
            }
            if(el === degreeInput){
              const ok = !!(degreeInput.value||'').trim();
              if(!ok){ showErr(degreeInput, 'Ø§Ø®ØªØ± Ø§Ù„Ø¯Ø±Ø¬Ø©', 'ÙŠØ±Ø¬Ù‰ Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ø¯Ø±Ø¬Ø© Ø§Ù„Ø¹Ù„Ù…ÙŠØ©'); if(!firstInvalid) firstInvalid = degreeInput; } else { hideErr(degreeInput); }
              degreeInput.classList.toggle('valid', ok);
              continue;
            }
            const val = (el.value||'').trim();
            if(!val){
              let title = 'Ù‡Ø°Ø§ Ø§Ù„Ø­Ù‚Ù„ Ù…Ø·Ù„ÙˆØ¨', sub = 'Ø±Ø¬Ø§Ø¡Ù‹ Ø§Ù…Ù„Ø£ Ù‡Ø°Ø§ Ø§Ù„Ø­Ù‚Ù„';
              if(el === skillsInput) { title = 'Ø£Ø¯Ø®Ù„ Ù…Ù‡Ø§Ø±Ø§ØªÙƒ'; sub = 'Ø§Ø°ÙƒØ± Ø£Ø¨Ø±Ø² Ù…Ù‡Ø§Ø±Ø§ØªÙƒ Ø¨Ø§Ø®ØªØµØ§Ø±'; }
              if(el === preferredCommitteeInput) { title = 'Ø­Ø¯Ø¯ Ø§Ù„Ù„Ø¬Ù†Ø© Ø§Ù„Ù…Ø±ØºÙˆØ¨ Ø¨Ù‡Ø§'; sub = 'Ø§Ø®ØªØ± Ø§Ù„Ù„Ø¬Ù†Ø© Ø§Ù„ØªÙŠ ØªØ±ØºØ¨ Ø¨Ø§Ù„Ø§Ù†Ø¶Ù…Ø§Ù… Ø¥Ù„ÙŠÙ‡Ø§'; }
              if(el === collegeInput) { title = 'Ø£Ø¯Ø®Ù„ Ø§Ø³Ù… Ø§Ù„ÙƒÙ„ÙŠØ©'; sub = 'Ù…Ø«Ù„: ÙƒÙ„ÙŠØ© Ø§Ù„Ø¢Ø¯Ø§Ø¨'; }
              if(el === majorInput) { title = 'Ø£Ø¯Ø®Ù„ Ø§Ø³Ù… Ø§Ù„ØªØ®ØµØµ'; sub = 'Ù…Ø«Ù„: Ø§Ù„Ù„ØºØ© Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©'; }
              showErr(el, title, sub);
              if(!firstInvalid) firstInvalid = el;
            } else {
              hideErr(el);
              el.classList.toggle('valid', true);
            }
          }
          if(firstInvalid){ if(firstInvalid===skillsInput && skillsUI){ skillsUI.focus(); } else { firstInvalid.focus(); } return false; }
          return true;
        }

        // Show on blur only; hide on input after touched
        if(fullNameInput){
          fullNameInput.addEventListener('input', ()=>{
            if(!touched.has('fullName')) { updateStepHint(); return; }
            const parts = (fullNameInput.value||'').trim().split(/\s+/).filter(Boolean);
            if(parts.length >= 3){ hideErr(fullNameInput); }
            updateStepHint();
          });
          fullNameInput.addEventListener('blur', ()=>{
            touched.add('fullName');
            const parts = (fullNameInput.value||'').trim().split(/\s+/).filter(Boolean);
            if(parts.length >= 3){ hideErr(fullNameInput); }
            else { showErr(fullNameInput, 'Ø£Ø¯Ø®Ù„ Ø§Ø³Ù…Ùƒ Ø§Ù„Ø«Ù„Ø§Ø«ÙŠ', 'Ø§Ù„Ø§Ø³Ù… Ø§Ù„Ø£ÙˆÙ„ØŒ Ø§Ø³Ù… Ø§Ù„Ø£Ø¨ØŒ Ø§Ø³Ù… Ø§Ù„Ø¹Ø§Ø¦Ù„Ø©'); }
            updateStepHint();
          });
        }
        if(phoneInput){
          phoneInput.addEventListener('input', ()=>{
            const raw = (phoneInput.value||'').trim();
            let sanitized = raw
              .replace(/[\u0660-\u0669]/g, ch => String.fromCharCode(ch.charCodeAt(0) - 0x0660 + 48))
              .replace(/[\u06F0-\u06F9]/g, ch => String.fromCharCode(ch.charCodeAt(0) - 0x06F0 + 48))
              .replace(/[^0-9]/g,'')
              .slice(0, 10);
            if(sanitized !== phoneInput.value){ phoneInput.value = sanitized; }
            if(!touched.has('phone')) return;
            const ok = /^05\d{8}$/.test(sanitized);
            if(ok){ hideErr(phoneInput); }
          });
          phoneInput.addEventListener('blur', ()=>{
            touched.add('phone');
            const raw = (phoneInput.value||'').trim();
            let digits = raw
              .replace(/[\u0660-\u0669]/g, ch => String.fromCharCode(ch.charCodeAt(0) - 0x0660 + 48))
              .replace(/[\u06F0-\u06F9]/g, ch => String.fromCharCode(ch.charCodeAt(0) - 0x06F0 + 48))
              .replace(/[^0-9]/g,'')
              .slice(0, 10);
            if(digits !== phoneInput.value){ phoneInput.value = digits; }
            const ok = /^05\d{8}$/.test(digits);
            if(ok){ hideErr(phoneInput); }
            else { showErr(phoneInput, 'Ø£Ø¯Ø®Ù„ Ø±Ù‚Ù… Ø¬ÙˆØ§Ù„ ØµØ­ÙŠØ­', '10 Ø£Ø±Ù‚Ø§Ù… ØªØ¨Ø¯Ø£ Ø¨Ù€ 05 (Ù…Ø«Ø§Ù„: 05XXXXXXXX)'); }
          });
        }
        if(emailInput){
          emailInput.addEventListener('input', ()=>{
            if(!touched.has('email')) return;
            const val = (emailInput.value||'').trim();
            const ok = /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(val);
            if(ok){ hideErr(emailInput); }
          });
          emailInput.addEventListener('blur', ()=>{
            touched.add('email');
            const val = (emailInput.value||'').trim();
            const ok = /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(val);
            if(ok){ hideErr(emailInput); }
            else { showErr(emailInput, 'Ø£Ø¯Ø®Ù„ Ø¨Ø±ÙŠØ¯Ù‹Ø§ Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠÙ‹Ø§ ØµØ§Ù„Ø­Ù‹Ø§', 'Ù…Ø«Ø§Ù„: name@example.com'); }
          });
        }
        if(degreeInput){
          degreeInput.addEventListener('change', ()=>{
            touched.add('degree');
            const ok = !!(degreeInput.value||'').trim();
            if(ok){ hideErr(degreeInput); } else { showErr(degreeInput, 'Ø§Ø®ØªØ± Ø§Ù„Ø¯Ø±Ø¬Ø©', 'ÙŠØ±Ø¬Ù‰ Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ø¯Ø±Ø¬Ø© Ø§Ù„Ø¹Ù„Ù…ÙŠØ©'); }
          });
        }
        function renderSkillsChips(){
          if(!skillsChips) return;
          Array.from(skillsChips.querySelectorAll('.chip')).forEach(n=>n.remove());
          skillsTags.forEach((txt, idx)=>{
            const chip = document.createElement('span');
            chip.className = 'chip';
            chip.innerHTML = `<span>${txt}</span><button type="button" class="remove" aria-label="Ø­Ø°Ù ${txt}" data-idx="${idx}"><i class="fa-solid fa-xmark"></i></button>`;
            skillsChips.insertBefore(chip, skillsUI);
            const btn = chip.querySelector('.remove');
            btn.addEventListener('click', ()=>{ skillsTags.splice(idx,1); updateSkillsValue(); renderSkillsChips(); });
          });
        }
        function normalizeTag(v){ return v.replace(/[ØŒ,]+/g,' ').replace(/\s+/g,' ').trim(); }
        function updateSkillsValue(){ if(skillsInput) skillsInput.value = skillsTags.join(', '); const ok = (skillsInput.value||'').trim().length>0; if(skillsTouched){ if(ok){ hideErr(skillsInput); } else { showErr(skillsInput, 'Ø£Ø¯Ø®Ù„ Ù…Ù‡Ø§Ø±Ø§ØªÙƒ', 'Ø§Ø°ÙƒØ± Ø£Ø¨Ø±Ø² Ù…Ù‡Ø§Ø±Ø§ØªÙƒ Ø¨Ø§Ø®ØªØµØ§Ø±'); } } }
        function addSkillFromValue(v){ const tag = normalizeTag(v); if(!tag) return; if(!skillsTags.includes(tag)){ skillsTags.push(tag); updateSkillsValue(); renderSkillsChips(); } }
        if(skillsUI){
          skillsUI.addEventListener('keydown', (e)=>{
            if(e.key==='Enter' || e.key===',') { e.preventDefault(); addSkillFromValue(skillsUI.value); skillsUI.value=''; }
            else if(e.key==='Backspace' && !skillsUI.value){ skillsTags.pop(); updateSkillsValue(); renderSkillsChips(); }
          });
          skillsUI.addEventListener('blur', ()=>{ addSkillFromValue(skillsUI.value); skillsUI.value=''; skillsTouched = true; updateSkillsValue(); });
          skillsUI.addEventListener('paste', (e)=>{ const text=(e.clipboardData||window.clipboardData).getData('text'); if(text){ e.preventDefault(); text.split(/\n|,|ØŒ/).forEach(t=>addSkillFromValue(t)); skillsUI.value=''; } });
          skillsUI.addEventListener('input', ()=>{ if(addSkillBtn){ addSkillBtn.disabled = normalizeTag(skillsUI.value).length===0; } });
        }
        if(addSkillBtn){ addSkillBtn.addEventListener('click', ()=>{ addSkillFromValue(skillsUI.value); skillsUI.value=''; addSkillBtn.disabled = true; skillsUI.focus(); }); addSkillBtn.disabled = true; }
        if(skillsInput){ updateSkillsValue(); renderSkillsChips(); }
        if(preferredCommitteeInput){
          const validatePreferredCommittee = ()=>{
            if(!touched.has('preferredCommittee')) return;
            const ok = (preferredCommitteeInput.value||'').trim().length>0;
            if(ok){ hideErr(preferredCommitteeInput); } else { showErr(preferredCommitteeInput, 'Ø­Ø¯Ø¯ Ø§Ù„Ù„Ø¬Ù†Ø© Ø§Ù„Ù…Ø±ØºÙˆØ¨ Ø¨Ù‡Ø§', 'Ø§Ø®ØªØ± Ø§Ù„Ù„Ø¬Ù†Ø© Ø§Ù„ØªÙŠ ØªØ±ØºØ¨ Ø¨Ø§Ù„Ø§Ù†Ø¶Ù…Ø§Ù… Ø¥Ù„ÙŠÙ‡Ø§'); }
          };
          preferredCommitteeInput.addEventListener('input', ()=>{ if(touched.has('preferredCommittee')){ const ok=(preferredCommitteeInput.value||'').trim().length>0; if(ok) hideErr(preferredCommitteeInput); } });
          preferredCommitteeInput.addEventListener('change', ()=>{ touched.add('preferredCommittee'); validatePreferredCommittee(); });
        }
        if(collegeInput){
          collegeInput.addEventListener('input', ()=>{
            if(!touched.has('college')) return;
            const ok = (collegeInput.value||'').trim().length>0;
            if(ok){ hideErr(collegeInput); }
          });
          collegeInput.addEventListener('blur', ()=>{
            touched.add('college');
            const ok = (collegeInput.value||'').trim().length>0;
            if(ok){ hideErr(collegeInput); } else { showErr(collegeInput, 'Ø£Ø¯Ø®Ù„ Ø§Ø³Ù… Ø§Ù„ÙƒÙ„ÙŠØ©', 'Ù…Ø«Ù„: ÙƒÙ„ÙŠØ© Ø§Ù„Ø¢Ø¯Ø§Ø¨'); }
          });
        }
        if(majorInput){
          majorInput.addEventListener('input', ()=>{
            if(!touched.has('major')) return;
            const ok = (majorInput.value||'').trim().length>0;
            if(ok){ hideErr(majorInput); }
          });
          majorInput.addEventListener('blur', ()=>{
            touched.add('major');
            const ok = (majorInput.value||'').trim().length>0;
            if(ok){ hideErr(majorInput); } else { showErr(majorInput, 'Ø£Ø¯Ø®Ù„ Ø§Ø³Ù… Ø§Ù„ØªØ®ØµØµ', 'Ù…Ø«Ù„: Ø§Ù„Ù„ØºØ© Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©'); }
          });
        }

        prevBtn.addEventListener('click', ()=>{ showStep(cur-1); });
        nextBtn.addEventListener('click', ()=>{ if(validateStep()) showStep(cur+1); });

        // Prevent Enter from submitting on non-final steps
        form.addEventListener('keydown', (e)=>{
          if(e.key !== 'Enter') return;
          const t = e.target;
          const tag = (t && t.tagName) || '';
          // Allow multiline in textarea and Enter inside skills UI (already handled there)
          if(tag === 'TEXTAREA' || (t && t.id === 'skillsInputUI')) return;
          if(cur < panes.length - 1){
            e.preventDefault();
          }
        });

        form.addEventListener('submit', async (e)=>{
          e.preventDefault();
          status.style.display='none'; status.className='alert'; status.textContent='';
          if(!validateStep()) return;
          // Only submit on the last step; otherwise behave like Next
          if(cur < panes.length - 1){
            showStep(cur+1);
            return;
          }
          const s0 = publicSettingsGet();
          // Ø§Ù„Ø³Ù…Ø§Ø­ Ø¨Ø§Ù„Ø¥Ø±Ø³Ø§Ù„ Ø¥Ø°Ø§ ÙƒØ§Ù† Ù‡Ù†Ø§Ùƒ Ø¯Ø¹ÙˆØ© ØµØ§Ù„Ø­Ø© Ø£Ùˆ Ø§Ù„ØªØ³Ø¬ÙŠÙ„ Ù…ÙØªÙˆØ­
          const hasValidInvitation = !!invitationData;
          if(!hasValidInvitation && !isJoinOpenEffective(s0)){
            status.className = 'alert error';
            status.style.display = 'block';
            status.textContent = 'Ø¹Ø°Ø±Ù‹Ø§ØŒ Ø¨Ø§Ø¨ Ø§Ù„ØªØ³Ø¬ÙŠÙ„ Ù…ØºÙ„Ù‚ Ø­Ø§Ù„ÙŠÙ‹Ø§.';
            return;
          }
          const sb = window.sbClient;
          
          // ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬ Ù…Ù† Ø£ÙŠ session Ù…Ø³Ø¬Ù„ Ù„Ø¶Ù…Ø§Ù† Ø§Ø³ØªØ®Ø¯Ø§Ù… anon role
          if (sb) {
            try {
              await sb.auth.signOut();
            } catch (e) {
              console.warn('Sign out failed:', e);
            }
          }
          
          const payload = {
            full_name: document.getElementById('fullName').value.trim(),
            phone: document.getElementById('phone').value.trim() || null,
            email: document.getElementById('email').value.trim(),
            degree: document.getElementById('degree').value.trim() || null,
            college: document.getElementById('college').value.trim() || null,
            major: document.getElementById('major').value.trim() || null,
            skills: document.getElementById('skills').value.trim() || null,
            preferred_committee: document.getElementById('preferredCommittee').value.trim() || null,
            portfolio_url: document.getElementById('portfolioUrl').value.trim() || null,
            social_twitter: document.getElementById('twitter').value.trim() || null,
            social_instagram: document.getElementById('instagram').value.trim() || null,
            social_linkedin: document.getElementById('linkedin').value.trim() || null,
            about: document.getElementById('about').value.trim(),
            created_at: new Date().toISOString(),
            status: 'new',
            visitor_id: getVisitorId(),
            session_id: getSessionId(),
            path: location.pathname + location.search + location.hash,
            user_agent: (navigator.userAgent||'').slice(0,500)
          };

          const btns = [prevBtn, nextBtn, submitBtn];
          btns.forEach(b=>{ if(b){ b.disabled=true; b.style.opacity=.7; } });

          try{
            let saved = false;
            let remoteFailed = !sb;
            let applicationId = null;
            if(sb){
              try{
                const { data, error } = await sb.from('membership_applications').insert(payload).select().single();
                if(error) throw error;
                saved = true;
                applicationId = data?.id;
                
                // ØªØ³Ø¬ÙŠÙ„ Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ø¯Ø¹ÙˆØ© Ø¥Ø°Ø§ ÙƒØ§Ù†Øª Ù…ÙˆØ¬ÙˆØ¯Ø©
                if (invitationData && applicationId) {
                  await recordInvitationUsage(
                    invitationData.id,
                    applicationId,
                    payload.full_name,
                    payload.email
                  );
                }
              } catch(e){ remoteFailed = true; saved = false; }
            }
            if(!saved){
              try{
                const k = 'adeeb_membership_applications';
                const raw = localStorage.getItem(k);
                const arr = raw ? JSON.parse(raw) : [];
                arr.push(payload);
                localStorage.setItem(k, JSON.stringify(arr));
                saved = true;
              } catch(e){ saved = false; }
            }
            if(!saved) throw new Error('ØªØ¹Ø°Ø± Ø­ÙØ¸ Ø§Ù„Ø·Ù„Ø¨. Ø­Ø§ÙˆÙ„ Ù„Ø§Ø­Ù‚Ù‹Ø§.');

            const wrap = document.querySelector('.card');
            let html = '';
            if(remoteFailed){
              html = `
                <div class="success-wrap">
                  <div style="width:90px;height:90px;margin:0 auto 10px;display:grid;place-items:center;border-radius:50%;background:linear-gradient(135deg,rgba(220,38,38,.12),rgba(220,38,38,.06));box-shadow:0 8px 22px rgba(220,38,38,.2), inset 0 1px 0 rgba(255,255,255,.6);">
                    <i class="fa-solid fa-circle-xmark fa-bounce" style="font-size:48px;color:#dc2626;"></i>
                  </div>
                  <h2 style="margin:10px 0 6px">ØªØ¹Ø°Ù‘Ø± Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø·Ù„Ø¨</h2>
                  <p class="muted"> ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø¥Ù†ØªØ±Ù†Øª Ø«Ù… Ø§Ø¶ØºØ· Â«Ø£Ø¹Ø¯ Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø©Â».</p>
                  <div style="margin-top:16px;display:flex;flex-wrap:wrap;gap:10px;justify-content:center">
                    <button id="retrySubmitBtn" class="btn btn-primary"><i class="fa-solid fa-rotate-right"></i> Ø£Ø¹Ø¯ Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø©</button>
                  </div>
                </div>`;
            } else {
              html = `
                <div class="success-wrap">
                  <div style="width:90px;height:90px;margin:0 auto 10px;display:grid;place-items:center;border-radius:50%;background:linear-gradient(135deg,rgba(16,185,129,.12),rgba(16,185,129,.06));box-shadow:0 8px 22px rgba(16,185,129,.2), inset 0 1px 0 rgba(255,255,255,.6);">
                    <i class="fa-solid fa-circle-check fa-bounce" style="font-size:48px;color:#16a34a;"></i>
                  </div>
                  <h2 style="margin:10px 0 6px">ØªÙ… Ø§Ø³ØªÙ„Ø§Ù… Ø·Ù„Ø¨Ùƒ Ø¨Ù†Ø¬Ø§Ø­</h2>
                  <p class="muted">Ø´ÙƒØ±Ù‹Ø§ Ù„Ø§Ù†Ø¶Ù…Ø§Ù…Ùƒ Ø¥Ù„Ù‰ Ù†Ø§Ø¯ÙŠ Ø£Ø¯ÙŠØ¨. Ø³Ù†Ø±Ø§Ø¬Ø¹ Ø·Ù„Ø¨Ùƒ ÙˆÙ†ØªÙˆØ§ØµÙ„ Ù…Ø¹Ùƒ Ù‚Ø±ÙŠØ¨Ù‹Ø§.</p>
                  <div style="margin-top:16px;display:flex;flex-wrap:wrap;gap:10px;justify-content:center">
                    <a class="btn btn-outline" href="index.html" target="_blank" rel="noopener">
                      <i class="fa-solid fa-globe"></i> ØªØµÙØ­ Ù…ÙˆÙ‚Ø¹ Ø£Ø¯ÙÙŠØ¨
                    </a>
                    <a class="btn btn-outline" href="https://x.com/AB_KFU/status/1978136260439925161" target="_blank" rel="noopener">
                      <i class="fa-solid fa-play"></i> Ù…ÙØ´Ø§Ù‡Ø¯Ø© Ø§Ù„ÙÙŠØ¯ÙŠÙˆ Ø§Ù„ØªØ±ÙˆÙŠØ¬ÙŠ
                    </a>
                    <a class="btn btn-primary" href="membership.html">
                      <i class="fa-solid fa-user-plus"></i> ØªØ³Ø¬ÙŠÙ„ Ø¬Ø¯ÙŠØ¯
                    </a>
                  </div>
                </div>`;
            }
            wrap.innerHTML = html;
            if(remoteFailed){
              const retryBtn = document.getElementById('retrySubmitBtn');
              if(retryBtn){
                retryBtn.addEventListener('click', async ()=>{
                  retryBtn.disabled = true; retryBtn.style.opacity = .7;
                  try{
                    if(!sb) throw new Error('Ø§Ù„Ø®Ø¯Ù…Ø© ØºÙŠØ± Ù…ØªØ§Ø­Ø© Ø§Ù„Ø¢Ù†');
                    const { error } = await sb.from('membership_applications').insert(payload);
                    if(error) throw error;
                    wrap.innerHTML = `
                      <div class="success-wrap">
                        <div style="width:90px;height:90px;margin:0 auto 10px;display:grid;place-items:center;border-radius:50%;background:linear-gradient(135deg,rgba(16,185,129,.12),rgba(16,185,129,.06));box-shadow:0 8px 22px rgba(16,185,129,.2), inset 0 1px 0 rgba(255,255,255,.6);">
                          <i class="fa-solid fa-circle-check fa-bounce" style="font-size:48px;color:#16a34a;"></i>
                        </div>
                        <h2 style="margin:10px 0 6px">ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø·Ù„Ø¨ Ø¨Ù†Ø¬Ø§Ø­</h2>
                        <p class="muted">Ø´ÙƒØ±Ù‹Ø§ Ù„Ø§Ù†Ø¶Ù…Ø§Ù…Ùƒ Ø¥Ù„Ù‰ Ù†Ø§Ø¯ÙŠ Ø£Ø¯ÙŠØ¨. Ø³Ù†Ø±Ø§Ø¬Ø¹ Ø·Ù„Ø¨Ùƒ ÙˆÙ†ØªÙˆØ§ØµÙ„ Ù…Ø¹Ùƒ Ù‚Ø±ÙŠØ¨Ù‹Ø§.</p>
                        <div style="margin-top:16px;display:flex;flex-wrap:wrap;gap:10px;justify-content:center">
                          <a class="btn btn-outline" href="index.html" target="_blank" rel="noopener">
                            <i class="fa-solid fa-globe"></i> ØªØµÙØ­ Ù…ÙˆÙ‚Ø¹ Ø£Ø¯ÙÙŠØ¨
                          </a>
                          <a class="btn btn-outline" href="https://www.youtube.com/@ab_kfu" target="_blank" rel="noopener">
                            <i class="fa-solid fa-play"></i> Ù…ÙØ´Ø§Ù‡Ø¯Ø© Ø§Ù„ÙÙŠØ¯ÙŠÙˆ Ø§Ù„ØªØ±ÙˆÙŠØ¬ÙŠ
                          </a>
                          <a class="btn btn-primary" href="membership.html">
                            <i class="fa-solid fa-user-plus"></i> ØªØ³Ø¬ÙŠÙ„ Ø¬Ø¯ÙŠØ¯
                          </a>
                        </div>
                      </div>`;
                  } catch(e){
                    let errBox = wrap.querySelector('.retry-error-box');
                    if(!errBox){
                      errBox = document.createElement('div');
                      errBox.className = 'alert error retry-error-box';
                      errBox.setAttribute('role','alert');
                      errBox.style.display = 'block';
                      errBox.style.margin = '10px auto 0';
                      errBox.style.maxWidth = '540px';
                      errBox.innerHTML = `<i class="fa-solid fa-triangle-exclamation"></i> <span>Ù„Ø§ ÙŠØ²Ø§Ù„ Ø§Ù„Ø¥Ø±Ø³Ø§Ù„ Ù…ØªØ¹Ø°Ø±Ù‹Ø§. ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø§ØªØµØ§Ù„ ÙˆØ­Ø§ÙˆÙ„ Ù…Ø¬Ø¯Ø¯Ù‹Ø§.</span>`;
                      const sw = wrap.querySelector('.success-wrap');
                      if(sw) sw.insertBefore(errBox, sw.children[1] || null);
                    } else {
                      errBox.style.display = 'block';
                    }
                  } finally {
                    retryBtn.disabled = false; retryBtn.style.opacity = 1;
                  }
                });
              }
            }
          } catch(err){
            status.className = 'alert error';
            status.textContent = (err && err.message) ? err.message : 'Ø­Ø¯Ø« Ø®Ø·Ø£ ØºÙŠØ± Ù…ØªÙˆÙ‚Ø¹';
            status.style.display='block';
          } finally {
            btns.forEach(b=>{ if(b){ b.disabled=false; b.style.opacity=1; } });
          }
        });

        function updateCollegeMajorVisibility(){
          const val = ((degreeInput && degreeInput.value) || '').trim();
          const hide = (val === 'Ø«Ø§Ù†ÙˆÙŠ' || val === 'Ù…ÙˆØ¸Ù');
          if(collegeMajorRow) collegeMajorRow.style.display = hide ? 'none' : '';
          if(collegeInput){
            if(hide){ collegeInput.removeAttribute('required'); collegeInput.value=''; }
            else { collegeInput.setAttribute('required',''); }
          }
          if(majorInput){
            if(hide){ majorInput.removeAttribute('required'); majorInput.value=''; }
            else { majorInput.setAttribute('required',''); }
          }
        }
        if(degreeInput){ degreeInput.addEventListener('change', updateCollegeMajorVisibility); }
        updateCollegeMajorVisibility();

        showStep(0);

        // Ù†Ø¸Ø§Ù… Ø§Ù„Ø¯Ø¹ÙˆØ§Øª
        let invitationCode = null;
        let invitationData = null;
        let allowedCommittees = null;

        // Ù‚Ø±Ø§Ø¡Ø© ÙƒÙˆØ¯ Ø§Ù„Ø¯Ø¹ÙˆØ© Ù…Ù† Ø§Ù„Ø±Ø§Ø¨Ø·
        function getInvitationCode() {
          const params = new URLSearchParams(window.location.search);
          return params.get('invite');
        }

        // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ØµÙ„Ø§Ø­ÙŠØ© Ø§Ù„Ø¯Ø¹ÙˆØ©
        async function validateInvitation(code) {
          if (!code) return null;
          
          try {
            const sb = window.sbClient;
            if (!sb) return null;

            const { data, error } = await sb.rpc('validate_invitation', {
              p_code: code
            });

            if (error) throw error;

            console.log('Invitation validation result:', data);

            // Supabase RPC returns array, get first element
            const result = Array.isArray(data) ? data[0] : data;

            if (result && result.is_valid) {
              return {
                id: result.invitation_id,
                code: code,
                mode: result.committee_mode,
                committeeId: result.selected_committee_id,
                committeeIds: result.selected_committee_ids,
                expiresAt: result.expires_at,
                remainingUses: result.remaining_uses
              };
            }
            return null;
          } catch (error) {
            console.error('Ø®Ø·Ø£ ÙÙŠ Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø¯Ø¹ÙˆØ©:', error);
            return null;
          }
        }

        // ØªØ³Ø¬ÙŠÙ„ Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ø¯Ø¹ÙˆØ©
        async function recordInvitationUsage(invitationId, applicationId, applicantName, applicantEmail) {
          try {
            const sb = window.sbClient;
            if (!sb || !invitationId) return;

            await sb.from('invitation_usages').insert({
              invitation_id: invitationId,
              application_id: applicationId,
              applicant_name: applicantName,
              applicant_email: applicantEmail
            });
          } catch (error) {
            console.error('Ø®Ø·Ø£ ÙÙŠ ØªØ³Ø¬ÙŠÙ„ Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ø¯Ø¹ÙˆØ©:', error);
          }
        }

        // Ø¹Ø¯Ø§Ø¯ ÙˆÙ‚Øª ØµÙ„Ø§Ø­ÙŠØ© Ø±Ø§Ø¨Ø· Ø§Ù„Ø¯Ø¹ÙˆØ©
        let invCountdownInterval = null;
        function startInvitationCountdown(expiresAt) {
          const invWrap = document.getElementById('invitationCountdown');
          const invDays = document.getElementById('invDays');
          const invHours = document.getElementById('invHours');
          const invMinutes = document.getElementById('invMinutes');
          const invSeconds = document.getElementById('invSeconds');
          
          if (!invWrap || !expiresAt) return;
          
          // Ø¥ÙŠÙ‚Ø§Ù Ø§Ù„Ø¹Ø¯Ø§Ø¯ Ø§Ù„Ø³Ø§Ø¨Ù‚ Ø¥Ù† ÙˆØ¬Ø¯
          if (invCountdownInterval) {
            clearInterval(invCountdownInterval);
          }
          
          const targetTime = new Date(expiresAt).getTime();
          
          function updateCountdown() {
            const now = Date.now();
            const diff = targetTime - now;
            
            if (diff <= 0) {
              // Ø§Ù†ØªÙ‡Øª Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ©
              invWrap.style.display = 'none';
              if (invCountdownInterval) {
                clearInterval(invCountdownInterval);
              }
              // Ø¥Ø¹Ø§Ø¯Ø© ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø© Ù„Ø¥Ø¸Ù‡Ø§Ø± Ø±Ø³Ø§Ù„Ø© Ø§Ù†ØªÙ‡Ø§Ø¡ Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ©
              window.location.reload();
              return;
            }
            
            const days = Math.floor(diff / (1000 * 60 * 60 * 24));
            const hours = Math.floor((diff % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
            const minutes = Math.floor((diff % (1000 * 60 * 60)) / (1000 * 60));
            const seconds = Math.floor((diff % (1000 * 60)) / 1000);
            
            if (invDays) invDays.textContent = String(days).padStart(2, '0');
            if (invHours) invHours.textContent = String(hours).padStart(2, '0');
            if (invMinutes) invMinutes.textContent = String(minutes).padStart(2, '0');
            if (invSeconds) invSeconds.textContent = String(seconds).padStart(2, '0');
            
            invWrap.style.display = 'block';
          }
          
          updateCountdown();
          invCountdownInterval = setInterval(updateCountdown, 1000);
        }

        // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù„Ø¬Ø§Ù† Ø§Ù„Ù…ØªØ§Ø­Ø©
        let activeCommittees = [];
        async function loadCommittees() {
          try {
            const sb = window.sbClient;
            if (!sb) return;

            // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ÙˆØ¬ÙˆØ¯ Ø¯Ø¹ÙˆØ©
            invitationCode = getInvitationCode();
            if (invitationCode) {
              invitationData = await validateInvitation(invitationCode);
              
              if (!invitationData) {
                // Ø¯Ø¹ÙˆØ© ØºÙŠØ± ØµØ§Ù„Ø­Ø©
                const status = document.getElementById('status');
                if (status) {
                  status.className = 'alert error';
                  status.style.display = 'block';
                  status.innerHTML = '<i class="fa-solid fa-triangle-exclamation"></i> Ø±Ø§Ø¨Ø· Ø§Ù„Ø¯Ø¹ÙˆØ© ØºÙŠØ± ØµØ§Ù„Ø­ Ø£Ùˆ Ù…Ù†ØªÙ‡ÙŠ Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ©';
                }
              } else {
                // Ø¯Ø¹ÙˆØ© ØµØ§Ù„Ø­Ø© - Ø¹Ø±Ø¶ Ø±Ø³Ø§Ù„Ø© ÙˆØªÙØ¹ÙŠÙ„ Ø§Ù„Ø¹Ø¯Ø§Ø¯
                const status = document.getElementById('status');
                if (status) {
                  status.className = 'alert';
                  status.style.display = 'block';
                  status.innerHTML = '<i class="fa-solid fa-envelope-open-text"></i> ØªÙ… ØªÙØ¹ÙŠÙ„ Ø±Ø§Ø¨Ø· Ø§Ù„Ø¯Ø¹ÙˆØ© Ø¨Ù†Ø¬Ø§Ø­';
                  setTimeout(() => { status.style.display = 'none'; }, 5000);
                }
                // ØªØ´ØºÙŠÙ„ Ø¹Ø¯Ø§Ø¯ ØµÙ„Ø§Ø­ÙŠØ© Ø§Ù„Ø¯Ø¹ÙˆØ©
                startInvitationCountdown(invitationData.expiresAt);
                // ØªØ­Ø¯ÙŠØ« Ø­Ø§Ù„Ø© Ø§Ù„ÙˆØ§Ø¬Ù‡Ø© Ù„Ù„Ø³Ù…Ø§Ø­ Ø¨Ø§Ù„ØªØ³Ø¬ÙŠÙ„
                enforceJoinAccess();
              }
            }

            const { data, error } = await sb
              .from('membership_available_committees')
              .select('*, committee:committees(*)')
              .eq('is_available', true)
              .order('committee(committee_name_ar)');

            if (error) throw error;

            activeCommittees = data || [];
            
            // ØªØ·Ø¨ÙŠÙ‚ Ù‚ÙŠÙˆØ¯ Ø§Ù„Ø¯Ø¹ÙˆØ© Ø¹Ù„Ù‰ Ø§Ù„Ù„Ø¬Ø§Ù†
            if (invitationData) {
              if (invitationData.mode === 'single' && invitationData.committeeId) {
                // Ù„Ø¬Ù†Ø© ÙˆØ§Ø­Ø¯Ø© ÙÙ‚Ø·
                activeCommittees = activeCommittees.filter(item => 
                  item.committee && item.committee.id === invitationData.committeeId
                );
                allowedCommittees = [invitationData.committeeId];
              } else if (invitationData.mode === 'multiple' && invitationData.committeeIds) {
                // Ù…Ø¬Ù…ÙˆØ¹Ø© Ù„Ø¬Ø§Ù† Ù…Ø­Ø¯Ø¯Ø©
                activeCommittees = activeCommittees.filter(item => 
                  item.committee && invitationData.committeeIds.includes(item.committee.id)
                );
                allowedCommittees = invitationData.committeeIds;
              }
              // Ø¥Ø°Ø§ ÙƒØ§Ù† 'all' ÙÙ„Ø§ Ù†Ø·Ø¨Ù‚ Ø£ÙŠ Ù‚ÙŠÙˆØ¯
            }
            
            // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ù†Ø³Ø¯Ù„Ø©
            const preferredCommitteeSelect = document.getElementById('preferredCommittee');
            if (preferredCommitteeSelect) {
              if (activeCommittees.length === 0) {
                preferredCommitteeSelect.innerHTML = '<option value="">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù„Ø¬Ø§Ù† Ù…ØªØ§Ø­Ø© Ø­Ø§Ù„ÙŠØ§Ù‹</option>';
              } else {
                preferredCommitteeSelect.innerHTML = '<option value="">Ø§Ø®ØªØ± Ø§Ù„Ù„Ø¬Ù†Ø©</option>';
                activeCommittees.forEach(item => {
                  const committee = item.committee;
                  const option = document.createElement('option');
                  option.value = committee.committee_name_ar;
                  option.textContent = committee.committee_name_ar;
                  
                  // Ø¥Ø¶Ø§ÙØ© ØªÙ†Ø¨ÙŠÙ‡ Ø¥Ø°Ø§ ÙƒØ§Ù†Øª Ø§Ù„Ù„Ø¬Ù†Ø© Ù…Ù…ØªÙ„Ø¦Ø©
                  if (item.max_applicants && item.current_applicants >= item.max_applicants) {
                    option.disabled = true;
                    option.textContent += ' (Ù…ÙƒØªÙ…Ù„Ø©)';
                  }
                  
                  preferredCommitteeSelect.appendChild(option);
                });
              }
            }

            // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù†Ø§ÙØ°Ø© Ø§Ù„Ù…Ù†Ø¨Ø«Ù‚Ø©
            updateCommitteeModal();
          } catch (error) {
            console.error('Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù„Ø¬Ø§Ù†:', error);
            const preferredCommitteeSelect = document.getElementById('preferredCommittee');
            if (preferredCommitteeSelect) {
              preferredCommitteeSelect.innerHTML = '<option value="">Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù„Ø¬Ø§Ù†</option>';
            }
          }
        }

        // ØªØ­Ø¯ÙŠØ« Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ù†Ø§ÙØ°Ø© Ø§Ù„Ù…Ù†Ø¨Ø«Ù‚Ø©
        function updateCommitteeModal() {
          const modalBody = document.getElementById('committeeModalBody');
          if (!modalBody) return;

          if (activeCommittees.length === 0) {
            modalBody.innerHTML = `
              <div style="text-align: center; padding: 40px 20px; color: #64748b;">
                <i class="fa-solid fa-info-circle" style="font-size: 3rem; color: #3d8fd6; margin-bottom: 15px;"></i>
                <p style="font-size: 1.1rem; color: #274060; margin: 0;">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù„Ø¬Ø§Ù† Ù…ØªØ§Ø­Ø© Ø­Ø§Ù„ÙŠØ§Ù‹</p>
                <p style="margin-top: 8px;">ÙŠØ±Ø¬Ù‰ Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø© Ù„Ø§Ø­Ù‚Ø§Ù‹</p>
              </div>
            `;
            return;
          }

          // Ø£ÙŠÙ‚ÙˆÙ†Ø§Øª Ø§Ù„Ù„Ø¬Ø§Ù†
          const committeeIcons = {
            'Ù„Ø¬Ù†Ø© Ø§Ù„ØªØ£Ù„ÙŠÙ': 'fa-pen-fancy',
            'Ù„Ø¬Ù†Ø© Ø§Ù„Ø±ÙˆØ§Ø©': 'fa-microphone',
            'Ù„Ø¬Ù†Ø© Ø§Ù„ÙØ¹Ø§Ù„ÙŠØ§Øª': 'fa-calendar-days',
            'Ù„Ø¬Ù†Ø© Ø§Ù„Ø¥Ù†ØªØ§Ø¬': 'fa-video',
            'Ù„Ø¬Ù†Ø© Ø§Ù„Ø³ÙØ±Ø§Ø¡': 'fa-handshake',
            'Ù„Ø¬Ù†Ø© Ø§Ù„ØªØµÙ…ÙŠÙ…': 'fa-palette',
            'Ù„Ø¬Ù†Ø© Ø§Ù„ØªØ³ÙˆÙŠÙ‚': 'fa-bullhorn'
          };

          let html = '';
          activeCommittees.forEach(item => {
            const committee = item.committee;
            const icon = committeeIcons[committee.committee_name_ar] || 'fa-users';
            const isFull = item.max_applicants && item.current_applicants >= item.max_applicants;
            
            html += `
              <div class="committee-item">
                <h3>
                  <i class="fa-solid ${icon}"></i> 
                  ${committee.committee_name_ar}
                  ${isFull ? '<span style="color: #ef4444; font-size: 0.85rem; margin-right: 8px;">(Ù…ÙƒØªÙ…Ù„Ø©)</span>' : ''}
                </h3>
                <p>${committee.description || 'Ù„Ø§ ÙŠÙˆØ¬Ø¯ ÙˆØµÙ Ù…ØªØ§Ø­ Ù„Ù‡Ø°Ù‡ Ø§Ù„Ù„Ø¬Ù†Ø©'}</p>
                ${item.max_applicants ? `
                  <p style="font-size: 0.9rem; color: #64748b; margin-top: 8px;">
                    <i class="fa-solid fa-users"></i>
                    Ø§Ù„Ù…ØªÙ‚Ø¯Ù…ÙŠÙ†: ${item.current_applicants || 0} / ${item.max_applicants}
                  </p>
                ` : ''}
              </div>
            `;
          });

          modalBody.innerHTML = html;
        }

        // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù„Ø¬Ø§Ù† Ø¹Ù†Ø¯ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø©
        loadCommittees();

        // Committee Info Modal
        const committeeInfoBtn = document.getElementById('committeeInfoBtn');
        const committeeModal = document.getElementById('committeeModal');
        const closeModalBtn = document.getElementById('closeModalBtn');

        if(committeeInfoBtn && committeeModal){
          committeeInfoBtn.addEventListener('click', (e)=>{
            e.preventDefault();
            committeeModal.classList.add('active');
          });
        }

        if(closeModalBtn && committeeModal){
          closeModalBtn.addEventListener('click', ()=>{
            committeeModal.classList.remove('active');
          });
        }

        if(committeeModal){
          // Close on backdrop click
          committeeModal.addEventListener('click', (e)=>{
            if(e.target === committeeModal){
              committeeModal.classList.remove('active');
            }
          });

          // Close on ESC key
          document.addEventListener('keydown', (e)=>{
            if(e.key === 'Escape' && committeeModal.classList.contains('active')){
              committeeModal.classList.remove('active');
            }
          });
        }
      })();
    </script>
  </body>
</html>
