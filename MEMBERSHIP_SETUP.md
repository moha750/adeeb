# دليل إعداد نظام إدارة العضوية

## نظرة عامة
تم إنشاء نظام متكامل لإدارة طلبات التسجيل في العضوية مع التحكم الكامل في فتح وإغلاق باب التسجيل من لوحة التحكم.

## الملفات التي تم إنشاؤها

### 1. ملفات قاعدة البيانات (Migrations)

#### `019_create_membership_tables.sql`
- إنشاء جدول `membership_applications` لتخزين طلبات العضوية
- إنشاء جدول `membership_settings` للتحكم في إعدادات التسجيل
- الحقول المتاحة في جدول الطلبات:
  - البيانات الشخصية (الاسم، البريد، الهاتف)
  - البيانات الأكاديمية (الدرجة، الكلية، التخصص)
  - المهارات واللجنة المرغوبة
  - حسابات التواصل الاجتماعي
  - حالة الطلب (جديد، قيد المراجعة، مقبول، مرفوض، مؤرشف)

#### `020_membership_rls_policies.sql`
- سياسات الأمان (RLS) للجداول
- السماح للجميع بإرسال طلبات التسجيل
- التحكم في الوصول للمستخدمين المصرح لهم فقط

#### `021_add_membership_permissions.sql`
- إضافة صلاحيات إدارة العضوية:
  - `membership.view` - عرض الطلبات
  - `membership.manage` - إدارة الطلبات
  - `membership.delete` - حذف الطلبات
  - `membership.settings` - التحكم في الإعدادات
  - `membership.export` - تصدير البيانات

### 2. ملفات لوحة التحكم

#### `admin/dashboard.html`
تم إضافة:
- قسم إدارة طلبات العضوية مع:
  - بطاقة التحكم في باب التسجيل
  - خيارات الجدولة التلقائية
  - إحصائيات الطلبات
  - جدول عرض الطلبات مع فلاتر بحث
  - نافذة عرض تفاصيل كل طلب

#### `admin/js/membership-manager.js`
مدير العضوية الذي يوفر:
- تحميل وعرض طلبات العضوية
- التحكم في إعدادات التسجيل
- مراجعة وقبول/رفض الطلبات
- إضافة ملاحظات إدارية
- تصدير البيانات إلى CSV
- تحديث الإحصائيات في الوقت الفعلي

#### `admin/dashboard.js`
تم تحديث:
- إضافة قسم العضوية في القائمة الجانبية
- تهيئة مدير العضوية عند تحميل القسم

## كيفية الإعداد

### 1. تشغيل ملفات Migration

قم بتشغيل الملفات التالية بالترتيب في قاعدة بيانات Supabase:

```bash
# في Supabase SQL Editor
1. 019_create_membership_tables.sql
2. 020_membership_rls_policies.sql
3. 021_add_membership_permissions.sql
```

أو استخدم Supabase CLI:

```bash
supabase db reset
```

### 2. التحقق من الصلاحيات

تأكد من أن المستخدمين لديهم الصلاحيات المناسبة:
- المدير (admin): جميع الصلاحيات
- المشرف (moderator): عرض وإدارة الطلبات فقط

### 3. الوصول إلى لوحة التحكم

1. سجل الدخول إلى لوحة التحكم: `admin/dashboard.html`
2. انتقل إلى قسم "إدارة العضوية" من القائمة الجانبية
3. ستجد جميع الأدوات اللازمة لإدارة التسجيل

## الميزات الرئيسية

### 1. التحكم في باب التسجيل

#### التحكم اليدوي
- فتح/إغلاق باب التسجيل بنقرة واحدة
- يتم تطبيق التغييرات فوراً على صفحة التسجيل

#### العد التنازلي
- إظهار مؤقت عد تنازلي لإغلاق التسجيل
- يظهر في أعلى صفحة التسجيل

#### الجدولة التلقائية
- جدولة فتح وإغلاق التسجيل تلقائياً
- ثلاثة أنماط:
  - **نطاق زمني**: تحديد وقت الفتح والإغلاق
  - **فتح فقط**: فتح التسجيل في وقت محدد
  - **إغلاق فقط**: إغلاق التسجيل في وقت محدد

### 2. إدارة الطلبات

#### عرض الطلبات
- جدول شامل لجميع الطلبات
- فلترة حسب:
  - الحالة (جديد، قيد المراجعة، مقبول، مرفوض)
  - اللجنة المرغوبة
  - البحث بالاسم أو البريد أو الهاتف

#### تفاصيل الطلب
- عرض كامل لبيانات المتقدم
- المهارات والخبرات
- حسابات التواصل الاجتماعي
- رابط الأعمال (Portfolio)

#### إجراءات الإدارة
- تغيير حالة الطلب
- إضافة ملاحظات إدارية
- تتبع من راجع الطلب ومتى
- حذف الطلبات

### 3. الإحصائيات

تحديث تلقائي للإحصائيات:
- عدد الطلبات الجديدة
- الطلبات قيد المراجعة
- الطلبات المقبولة
- الطلبات المرفوضة

### 4. التصدير

- تصدير جميع الطلبات إلى ملف CSV
- يتضمن جميع البيانات المهمة
- سهل الاستيراد في Excel أو Google Sheets

## كيفية الاستخدام

### فتح/إغلاق باب التسجيل

1. انتقل إلى قسم "إدارة العضوية"
2. في بطاقة "التحكم في باب التسجيل":
   - فعّل "فتح باب التسجيل" للسماح بالتسجيل
   - أو أوقف التفعيل لإغلاق التسجيل
3. اضغط "حفظ الإعدادات"

### جدولة التسجيل

1. فعّل "تفعيل الجدولة التلقائية"
2. اختر نمط الجدولة
3. حدد التواريخ والأوقات
4. اضغط "حفظ الإعدادات"

### مراجعة الطلبات

1. اضغط على "عرض" بجانب أي طلب
2. راجع جميع التفاصيل
3. غيّر الحالة إلى:
   - "قيد المراجعة" عند بدء المراجعة
   - "مقبول" للقبول
   - "مرفوض" للرفض
4. أضف ملاحظات إدارية إذا لزم الأمر
5. اضغط "حفظ التغييرات"

## التكامل مع صفحة التسجيل

صفحة `membership.html` تتصل تلقائياً بقاعدة البيانات وتتحقق من:
- حالة باب التسجيل (مفتوح/مغلق)
- إعدادات الجدولة
- عرض العد التنازلي إذا كان مفعلاً

عند إغلاق التسجيل، تظهر رسالة للزوار تخبرهم بإغلاق باب التسجيل.

## الأمان

- جميع الطلبات محمية بسياسات RLS
- فقط المستخدمون المصرح لهم يمكنهم عرض وإدارة الطلبات
- الزوار يمكنهم فقط إرسال طلبات جديدة
- جميع التغييرات يتم تسجيلها مع معلومات المراجع

## الدعم والمساعدة

إذا واجهت أي مشاكل:
1. تحقق من أن ملفات Migration تم تشغيلها بنجاح
2. تأكد من أن المستخدم لديه الصلاحيات المناسبة
3. راجع console المتصفح للأخطاء
4. تحقق من اتصال Supabase

## ملاحظات مهمة

- يتم تحديث حالة التسجيل في الوقت الفعلي باستخدام Realtime من Supabase
- التغييرات في لوحة التحكم تظهر فوراً في صفحة التسجيل
- يمكن للزوار إرسال الطلبات حتى لو كان الإنترنت منقطع (يتم حفظها محلياً)
- جميع التواريخ والأوقات بتوقيت المتصفح المحلي

---

تم إنشاء هذا النظام بواسطة Cascade AI
التاريخ: يناير 2026
