# ๐ ุฏููู ูุธุงู ุงูุชุฑุญูู ุงููุญุฏุซ - ูุณุฎุฉ 2.0

## ๐ ุงูุชุญุฏูุซุงุช ุงูุฑุฆูุณูุฉ

### โจ ูุง ุงูุฌุฏูุฏุ

1. **ุฅุฒุงูุฉ ุฏูุฑ "ุนุถู ุนุงุฏู"** โ
   - ุชู ุญุฐู ุฏูุฑ "ุนุถู ุนุงุฏู" (regular_member) ููุงุฆูุงู
   - ุฃุตุจุญ "ุนุถู ูุฌูุฉ" (committee_member) ูู ุฃูู ูุณุชูู ูู ุงููุธุงู
   - ุชู ุชุญููู ุฌููุน ุงูุฃุนุถุงุก ุงูุนุงุฏููู ุชููุงุฆูุงู ุฅูู ุฃุนุถุงุก ูุฌูุฉ

2. **ูุธุงู ุชุนุจุฆุฉ ุงูุจูุงูุงุช ุงูุดุงูู** ๐
   - ุฅุฑุณุงู ุฅูููู ุชุฑุญูุจู ุชููุงุฆู ููุนุถู ุงูููุจูู
   - ุฑุงุจุท ุขูู ูุชุนุจุฆุฉ ุงูุจูุงูุงุช ุงูุดุฎุตูุฉ ูุงูุฃูุงุฏูููุฉ
   - ูููุฐุฌ ุงุญุชุฑุงูู ูุฌูุน ุฌููุน ุงูุจูุงูุงุช ุงููุทููุจุฉ

3. **ุฌุฏูู ุจูุงูุงุช ุงูุฃุนุถุงุก ุงูุชูุตูููุฉ** ๐
   - ุฌุฏูู `member_details` ูุชุฎุฒูู ุงูุจูุงูุงุช ุงูุฅุถุงููุฉ
   - ุฌุฏูู `member_onboarding_tokens` ูุฅุฏุงุฑุฉ ุฑูุงุจุท ุงูุชุนุจุฆุฉ
   - ุชุญูู ุชููุงุฆู ูู ุงูุชูุงู ุงูุจูุงูุงุช

---

## ๐ ุงูุจูุงูุงุช ุงููุทููุจุฉ ูู ุงูุฃุนุถุงุก

### ุงูุจูุงูุงุช ุงูุฅูุฒุงููุฉ โ๏ธ

1. **ุงูุงุณู ุงูุซูุงุซู ุงููุงูู** - ุฅุฌุจุงุฑู
2. **ุฑูู ุงูุฌูุงู** - ุฅุฌุจุงุฑู (05xxxxxxxx)
3. **ุฑูู ุงููููุฉ ุงููุทููุฉ** - ุฅุฌุจุงุฑู (10 ุฃุฑูุงู)
4. **ุฑูู ุงูุณุฌู ุงูุฃูุงุฏููู** - ุฅุฌุจุงุฑู
5. **ุงูุจุฑูุฏ ุงูุฅููุชุฑููู** - ุฅุฌุจุงุฑู
6. **ุงูุฏุฑุฌุฉ ุงูุนูููุฉ** - ุฅุฌุจุงุฑู
   - ุซุงูููุฉ ุนุงูุฉ
   - ุฏุจููู
   - ุจูุงููุฑููุณ
   - ูุงุฌุณุชูุฑ
   - ุฏูุชูุฑุงู
   - ุฃุฎุฑู
7. **ุงููููุฉ** - ุฅุฌุจุงุฑู (ูู ุญุงู ูุฌูุฏ ุฏุฑุฌุฉ ุนูููุฉ ุบูุฑ ุซุงูููุฉ)
8. **ุงูุชุฎุตุต** - ุฅุฌุจุงุฑู (ูู ุญุงู ูุฌูุฏ ุฏุฑุฌุฉ ุนูููุฉ ุบูุฑ ุซุงูููุฉ)
9. **ุชุงุฑูุฎ ุงููููุงุฏ** - ุฅุฌุจุงุฑู
10. **ุงููุฌูุฉ** - ุฅุฌุจุงุฑู

### ุงูุจูุงูุงุช ุงูุงุฎุชูุงุฑูุฉ โน๏ธ

1. **ุญุณุงุจ ุชููุชุฑ** - ุงุฎุชูุงุฑู
2. **ุญุณุงุจ ุฅูุณุชูุฑุงู** - ุงุฎุชูุงุฑู
3. **ุญุณุงุจ ุชูู ุชูู** - ุงุฎุชูุงุฑู
4. **ุญุณุงุจ ููููุฏุฅู** - ุงุฎุชูุงุฑู

---

## ๐ ุณูุฑ ุงูุนูู ุงูุฌุฏูุฏ

```
1. ุงูููุจูู ูู membership_interviews (result = 'accepted')
   โ
2. ูุธูุฑ ูู ูุณู "ุชุฑุญูู ุงูููุจูููู"
   โ
3. ุงููุณุคูู ูุฑุงุฌุน ููุนุฏู ุงููุฌูุฉ (ุงุฎุชูุงุฑู)
   โ
4. ุงููุณุคูู ูุถุบุท "ุชุฑุญูู ุฅูู ุญุณุงุจ"
   โ
5. Edge Function ุชูุดุฆ ุงูุญุณุงุจ ุจุฏูุฑ "ุนุถู ูุฌูุฉ"
   โ
6. ูุชู ุฅุฑุณุงู ุฅูููู ุชุฑุญูุจู ุชููุงุฆูุงู ๐ง
   โ
7. ุงูุนุถู ููุชุญ ุงูุฅูููู ููุถุบุท ุนูู ุงูุฑุงุจุท
   โ
8. ุงูุนุถู ูุนุจุฆ ุจูุงูุงุชู ุงูุดุฎุตูุฉ ูุงูุฃูุงุฏูููุฉ
   โ
9. ูุชู ุญูุธ ุงูุจูุงูุงุช ูู member_details
   โ
10. ุงูุนุถู ููููู ุชุณุฌูู ุงูุฏุฎูู
   โ
11. ูุธูุฑ ูู "ุฅุฏุงุฑุฉ ุงููุณุชุฎุฏููู" ุจุฏูุฑ "ุนุถู ูุฌูุฉ"
```

---

## ๐๏ธ ุจููุฉ ูุงุนุฏุฉ ุงูุจูุงูุงุช ุงูุฌุฏูุฏุฉ

### ุฌุฏูู `member_details`

```sql
CREATE TABLE member_details (
    id uuid PRIMARY KEY,
    user_id uuid UNIQUE REFERENCES auth.users(id),
    
    -- ุงูุจูุงูุงุช ุงูุดุฎุตูุฉ
    full_name_triple text NOT NULL,
    phone text NOT NULL,
    national_id text NOT NULL UNIQUE,
    academic_record_number text NOT NULL UNIQUE,
    email text NOT NULL,
    birth_date date NOT NULL,
    
    -- ุงูุจูุงูุงุช ุงูุฃูุงุฏูููุฉ
    academic_degree text NOT NULL,
    college text,
    major text,
    
    -- ุงููุฌูุฉ
    committee_id integer REFERENCES committees(id),
    
    -- ุญุณุงุจุงุช ุงูุชูุงุตู (ุงุฎุชูุงุฑูุฉ)
    twitter_account text,
    instagram_account text,
    tiktok_account text,
    linkedin_account text,
    
    -- ุญุงูุฉ ุงูุงูุชูุงู
    is_complete boolean DEFAULT false,
    completed_at timestamptz,
    
    created_at timestamptz DEFAULT now(),
    updated_at timestamptz DEFAULT now()
);
```

### ุฌุฏูู `member_onboarding_tokens`

```sql
CREATE TABLE member_onboarding_tokens (
    id uuid PRIMARY KEY,
    user_id uuid REFERENCES auth.users(id),
    token text UNIQUE NOT NULL,
    
    interview_id uuid REFERENCES membership_interviews(id),
    application_id uuid REFERENCES membership_applications(id),
    
    is_used boolean DEFAULT false,
    used_at timestamptz,
    expires_at timestamptz NOT NULL,
    
    sent_to_email text NOT NULL,
    email_sent_at timestamptz DEFAULT now(),
    
    created_at timestamptz DEFAULT now()
);
```

---

## ๐ ุฎุทูุงุช ุงูุชุซุจูุช

### 1๏ธโฃ ุชุทุจูู Migration (ุชู โ)

```bash
# ุชู ุชุทุจูู Migration 056 ุจูุฌุงุญ
# - ุญุฐู ุฏูุฑ "ุนุถู ุนุงุฏู"
# - ุฅูุดุงุก ุฌุฏูู member_details
# - ุฅูุดุงุก ุฌุฏูู member_onboarding_tokens
```

### 2๏ธโฃ ุฑูุน Edge Functions

```bash
# ุฑูุน Edge Function ููุชุฑุญูู
supabase functions deploy migrate-accepted-member --project-ref nnlhkfeybyhvlinbqqfa

# ุฑูุน Edge Function ูุฅุฑุณุงู ุงูุฅูููู
supabase functions deploy send-member-welcome-email --project-ref nnlhkfeybyhvlinbqqfa
```

### 3๏ธโฃ ุฅุนุฏุงุฏ ุฎุฏูุฉ ุงูุฅูููู (ูุทููุจ)

ูุฅุฑุณุงู ุงูุฅููููุงุชุ ุชุญุชุงุฌ ุฅูู ุฅุนุฏุงุฏ **Resend API Key**:

1. ุณุฌู ูู [Resend.com](https://resend.com)
2. ุงุญุตู ุนูู API Key
3. ุฃุถูู ูู Supabase Dashboard:
   - ุงูุชูู ุฅูู **Settings** โ **Edge Functions**
   - ุฃุถู Secret: `RESEND_API_KEY`
   - ุงููููุฉ: API Key ุงูุฎุงุต ุจู

**ุจุฏุงุฆู ุฃุฎุฑู:**
- SendGrid
- AWS SES
- Mailgun
- ุฃู ุฎุฏูุฉ SMTP

---

## ๐ง ูุญุชูู ุงูุฅูููู ุงูุชุฑุญูุจู

ูุชููู ุงูุนุถู ุฅูููู ุงุญุชุฑุงูู ูุญุชูู ุนูู:

- ๐ ุฑุณุงูุฉ ุชููุฆุฉ ุจุงููุจูู
- ๐ ุฑุงุจุท ูุชุนุจุฆุฉ ุงูุจูุงูุงุช (ุตุงูุญ ููุฏุฉ 7 ุฃูุงู)
- โ๏ธ ุชุนูููุงุช ูุงุถุญุฉ
- ๐ ูุงุฆูุฉ ุจุงูุจูุงูุงุช ุงููุทููุจุฉ
- ๐จ ุชุตููู ุงุญุชุฑุงูู responsive

---

## ๐ฅ๏ธ ุตูุญุฉ ุชุนุจุฆุฉ ุงูุจูุงูุงุช

### ุงููููุฒุงุช:

- โ ุชุตููู ุงุญุชุฑุงูู responsive
- โ ุงูุชุญูู ูู ุตูุงุญูุฉ ุงูุฑุงุจุท
- โ ุชุนุจุฆุฉ ุชููุงุฆูุฉ ููุจูุงูุงุช ุงูููุฌูุฏุฉ
- โ ุฅุธูุงุฑ/ุฅุฎูุงุก ุฐูู ููุญููู
- โ ุงูุชุญูู ูู ุตุญุฉ ุงูุจูุงูุงุช
- โ ุฑุณุงุฆู ุฎุทุฃ ูุงุถุญุฉ
- โ ุญูุธ ุขูู ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช

### ุงูุฑุงุจุท:

```
https://adeeb-club.com/member-onboarding?token=UNIQUE_TOKEN
```

---

## ๐ ุงูุฃูุงู

### โ ุชู ุชุทุจููู:

1. **Tokens ุขููุฉ:**
   - UUID ูุฑูุฏ ููู ุนุถู
   - ุตูุงุญูุฉ 7 ุฃูุงู
   - ุงุณุชุฎุฏุงู ูุฑุฉ ูุงุญุฏุฉ ููุท
   - ุชุดููุฑ ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช

2. **RLS Policies:**
   - ุงููุณุชุฎุฏููู ูููููู ูุฑุงุกุฉ/ุชุญุฏูุซ ุจูุงูุงุชูู ููุท
   - ุงููุณุคูููู ูููููู ูุฑุงุกุฉ ุฌููุน ุงูุจูุงูุงุช
   - ุญูุงูุฉ ูู ุงููุตูู ุบูุฑ ุงููุตุฑุญ

3. **Edge Functions:**
   - ุงูุชุญูู ูู JWT
   - ุตูุงุญูุงุช Service Role
   - Rollback ุชููุงุฆู ุนูุฏ ุงููุดู

---

## ๐ ุฏููู ุงูุงุณุชุฎุฏุงู ูููุณุคูู

### 1. ุงููุตูู ุฅูู ูุณู ุงูุชุฑุญูู

1. ุณุฌู ุงูุฏุฎูู ุฅูู ููุญุฉ ุงูุชุญูู
2. **ุฅุฏุงุฑุฉ ุงูุนุถููุฉ** โ **ุชุฑุญูู ุงูููุจูููู**

### 2. ุชุฑุญูู ุนุถู ูุงุญุฏ

1. ุงุจุญุซ ุนู ุงูุนุถู
2. ุนุฏู ุงููุฌูุฉ ุฅุฐุง ูุฒู (ุงุฎุชูุงุฑู)
3. ุงุถุบุท **"ุชุฑุญูู ุฅูู ุญุณุงุจ"**
4. ุชุฃููุฏ ุงูุนูููุฉ
5. โ ุณูุชู ุฅุฑุณุงู ุงูุฅูููู ุชููุงุฆูุงู

### 3. ุชุฑุญูู ุฏูุนุฉ

1. ุญุฏุฏ ุงูุฃุนุถุงุก (checkbox)
2. ุงุถุบุท **"ุชุฑุญูู ุงููุญุฏุฏูู"**
3. ุชุฃููุฏ ุงูุนูููุฉ
4. ุงูุชุธุฑ ุงููุชุงุฆุฌ
5. โ ุณูุชู ุฅุฑุณุงู ุฅูููู ููู ุนุถู

### 4. ูุชุงุจุนุฉ ุชุนุจุฆุฉ ุงูุจูุงูุงุช

ููููู ูุชุงุจุนุฉ ุญุงูุฉ ุชุนุจุฆุฉ ุงูุจูุงูุงุช ูู ุฎูุงู:

```sql
-- ุนุฑุถ ุงูุฃุนุถุงุก ุงูุฐูู ูู ูููููุง ุจูุงูุงุชูู
SELECT 
    p.full_name,
    p.email,
    md.is_complete,
    mot.expires_at,
    mot.is_used
FROM profiles p
LEFT JOIN member_details md ON p.id = md.user_id
LEFT JOIN member_onboarding_tokens mot ON p.id = mot.user_id
WHERE md.is_complete = false OR md.is_complete IS NULL
ORDER BY p.created_at DESC;
```

---

## โ๏ธ ุงุณุชูุดุงู ุงูุฃุฎุทุงุก

### ุงููุดููุฉ: ูู ูุตู ุงูุฅูููู

**ุงูุฃุณุจุงุจ:**
- RESEND_API_KEY ุบูุฑ ููุนุฏ
- ุงูุจุฑูุฏ ุงูุฅููุชุฑููู ุฎุงุทุฆ
- ุงูุฅูููู ูู ูุฌูุฏ Spam

**ุงูุญู:**
1. ุชุญูู ูู ุฅุนุฏุงุฏ RESEND_API_KEY
2. ุชุญูู ูู ุตุญุฉ ุงูุจุฑูุฏ
3. ุฃุฑุณู ุงูุฑุงุจุท ูุฏููุงู ููุนุถู

### ุงููุดููุฉ: ุงูุชูุช ุตูุงุญูุฉ ุงูุฑุงุจุท

**ุงูุญู:**
1. ุงุญุฐู token ุงููุฏูู ูู `member_onboarding_tokens`
2. ุฃุนุฏ ุฅุฑุณุงู ุงูุฅูููู ูู ููุญุฉ ุงูุชุญูู

### ุงููุดููุฉ: ุงูุนุถู ูุง ูุณุชุทูุน ุชุณุฌูู ุงูุฏุฎูู

**ุงูุณุจุจ:**
- ูู ูููู ุชุนุจุฆุฉ ุจูุงูุงุชู

**ุงูุญู:**
- ุชุฃูุฏ ูู `member_details.is_complete = true`
- ุฑุงุฌุน ุงูุจูุงูุงุช ุงูููููุฏุฉ

---

## ๐ ุงูุฅุญุตุงุฆูุงุช ูุงูุชูุงุฑูุฑ

### ุนุฑุถ ุญุงูุฉ ุงูุฃุนุถุงุก

```sql
-- ุฅุญุตุงุฆูุงุช ุดุงููุฉ
SELECT 
    COUNT(*) FILTER (WHERE md.is_complete = true) as completed,
    COUNT(*) FILTER (WHERE md.is_complete = false) as pending,
    COUNT(*) FILTER (WHERE md.id IS NULL) as not_started
FROM profiles p
LEFT JOIN member_details md ON p.id = md.user_id
JOIN user_roles ur ON p.id = ur.user_id
WHERE ur.role_id = 9; -- ุนุถู ูุฌูุฉ
```

---

## ๐ ุฃูุซูุฉ ุนูููุฉ

### ูุซุงู 1: ุชุฑุญูู ุนุถู ูุงุญุฏ

```
1. ุฏุฎูู "ุชุฑุญูู ุงูููุจูููู"
2. ุงูุจุญุซ ุนู "ุฃุญูุฏ ูุญูุฏ"
3. ุชุบููุฑ ุงููุฌูุฉ ูู "ุงููุนุงููุงุช" ุฅูู "ุงูุชุฃููู"
4. ุงูุถุบุท ุนูู "ุชุฑุญูู ุฅูู ุญุณุงุจ"
5. โ ุชู ุฅูุดุงุก ุงูุญุณุงุจ
6. โ ุชู ุฅุฑุณุงู ุฅูููู ุชุฑุญูุจู
7. ุงูุนุถู ููุชุญ ุงูุฅูููู ููุนุจุฆ ุจูุงูุงุชู
8. โ ููููู ุชุณุฌูู ุงูุฏุฎูู
```

### ูุซุงู 2: ุชุฑุญูู ุฏูุนุฉ

```
1. ููุชุฑุฉ ุญุณุจ "ูุฌูุฉ ุงููุนุงููุงุช"
2. ุชุญุฏูุฏ 5 ุฃุนุถุงุก
3. ุงูุถุบุท ุนูู "ุชุฑุญูู ุงููุญุฏุฏูู (5)"
4. โ ุชู ุฅูุดุงุก 5 ุญุณุงุจุงุช
5. โ ุชู ุฅุฑุณุงู 5 ุฅููููุงุช
6. ุงูุฃุนุถุงุก ูุนุจุฆูู ุจูุงูุงุชูู
7. โ ูููููู ุชุณุฌูู ุงูุฏุฎูู
```

---

## ๐ ุงููุฑู ุจูู ุงููุณุฎุฉ ุงููุฏููุฉ ูุงูุฌุฏูุฏุฉ

| ุงูููุฒุฉ | ุงููุณุฎุฉ ุงููุฏููุฉ | ุงููุณุฎุฉ ุงูุฌุฏูุฏุฉ |
|--------|----------------|----------------|
| ุงูุฏูุฑ ุงูุงูุชุฑุงุถู | ุนุถู ุนุงุฏู (role_id: 10) | ุนุถู ูุฌูุฉ (role_id: 9) |
| ูููุฉ ุงููุฑูุฑ | ูุคูุชุฉ ูุฏููุฉ | ุฑุงุจุท ุชุนุจุฆุฉ ุจูุงูุงุช |
| ุงูุฅูููู | ูุฏูู | ุชููุงุฆู |
| ุงูุจูุงูุงุช | ุฃุณุงุณูุฉ ููุท | ุดุงููุฉ ูููุตูุฉ |
| ุงูุชุญูู | ูุฏูู | ุชููุงุฆู |

---

## ๐ ุงูุฏุนู

ูู ุญุงูุฉ ูุฌูุฏ ูุดุงูู:

1. ุฑุงุฌุน logs ุงูู Edge Functions
2. ุชุญูู ูู `activity_log`
3. ุฑุงุฌุน ูุฐุง ุงูุฏููู
4. ุชูุงุตู ูุน ุงูุฏุนู ุงูููู

---

## ๐ ุงูุฎูุงุตุฉ

ุงููุธุงู ุงููุญุฏุซ ูููุฑ:

- โ ุฅุฒุงูุฉ ุฏูุฑ "ุนุถู ุนุงุฏู" ููุงุฆูุงู
- โ ูุธุงู ุชุนุจุฆุฉ ุจูุงูุงุช ุงุญุชุฑุงูู
- โ ุฅููููุงุช ุชุฑุญูุจูุฉ ุชููุงุฆูุฉ
- โ ุฌูุน ุจูุงูุงุช ุดุงููุฉ
- โ ุฃูุงู ุนุงูู
- โ ุชุฌุฑุจุฉ ูุณุชุฎุฏู ููุชุงุฒุฉ

**ุงููุธุงู ุฌุงูุฒ ููุงุณุชุฎุฏุงู ุจุนุฏ ุฑูุน Edge Functions ูุฅุนุฏุงุฏ Resend!** ๐

---

## ๐ ุงููููุงุช ุงูููุดุฃุฉ/ุงููุญุฏุซุฉ

### Migrations:
- โ `056_update_member_role_and_add_member_details.sql`

### Edge Functions:
- โ `migrate-accepted-member/index.ts` (ูุญุฏุซ)
- ๐ `send-member-welcome-email/index.ts`

### Frontend:
- โ `admin/js/member-migration.js` (ูุญุฏุซ)
- ๐ `member-onboarding.html`

### Documentation:
- ๐ `UPDATED_MIGRATION_GUIDE.md`
